(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{394:function(t,e,i){"use strict";var a=function(){function Tabs(t,e,i,a,s,r,n){this.container=t,this.selector=e,this.parentWidget=i,this.chart=a,this.nav=s,this.chartUtils=r,this.trackArticleMetrics=n,this.thisTab=""}return Tabs.prototype.init=function(){this.select(),this.chartUtils.firstNDays(),this.nav.disable(),this.periods()},Tabs.prototype.select=function(){this.thisTab.closest(".metrics-tabs").querySelector(".metrics-selected--js").classList.remove("metrics-selected--js"),this.thisTab.classList.add("metrics-selected--js");var t=this.thisTab.closest(".metrics-tabs").querySelector(".metrics-tabs__link .link-text");t&&(t.textContent=this.thisTab.textContent)},Tabs.prototype.periods=function(){this.trackArticleMetrics.init("chart-time",null,null,this.thisTab.dataset.title),this.parentWidget.selections(),this.chart.eventUpdate(),this.parentWidget.selectedTabs=this.thisTab.closest("."+this.selector).querySelectorAll(".metrics-nav__item .metrics-selected--js")},Tabs}();e.a=a},395:function(t,e,i){"use strict";var a=i(266),s=i(270),r=function(){function Chart(t,e,i,a,s){this.container=t,this.selector=e,this.parentWidget=i,this.nav=a,this.chartUtils=s,this.isOneDot=!1}return Chart.prototype.init=function(t){this.total=new s.a(this.container,this.selector),this.data=t,this.parentWidget.selections(),this.build()},Chart.prototype.build=function(){var t=this,e=this.data;this.parentWidget.selectedSections=[];var i=[];this.parentWidget.selectedTabs.forEach((function(a){i.push(a.dataset.title),t.parentWidget.selectedSections.push(e.dataSections[e.dataSections.map((function(t){return t.id})).indexOf(a.dataset.title)]),t.total.init(a.dataset.title),t.total.add()})),i.length||i.push(this.container.querySelector(".metrics-nav__item-link").dataset.title),this.container.querySelector(".metrics-chart__svg")&&this.container.querySelector(".metrics-chart__svg").remove(),this.svgBuild(),this.update(i)},Chart.prototype.svgBuild=function(){var t=this,e=this.container.querySelector(".metrics-chart");e.setAttribute("role","alert"),this.parentWidget.svg=Object(a.m)(e).append("svg").attr("class","metrics-chart__svg").attr("font-family","sans-serif").attr("id","svg-"+Math.ceil(1e4*Math.random())).attr("preserveAspectRatio","xMinYMin").append("g"),Object(a.m)(this.container).filter((function(e){return"sidebar-metric"!==t.selector})).append("div").attr("class","metrics-chart__tooltip")},Chart.prototype.svgGetMargins=function(){var t={left:30,bottom:this.chartUtils.isfirstNDays?70:this.chartUtils.isTotalTab?55:40,right:5};return this.parentWidget.svg.select(".svg-metrics__y-axis").remove(),this.parentWidget.svg.append("g").lower().attr("class","svg-metrics__y-axis").append("g").attr("class","tick").attr("font-size",12).append("text").text(this.chartUtils.maxCount.toLocaleString(navigator.language)).each((function(){t.left=Math.floor(this.getBBox().width)})).remove(),t},Chart.prototype.svgApplyConfig=function(){this.svgConfig(this.svgGetMargins());var t=this.container.querySelector(".metrics-chart");Object(a.m)(t).select(".metrics-chart__svg").attr("width",this.parentWidget.width+this.parentWidget.margin.left+this.parentWidget.margin.right).attr("height",this.parentWidget.height+this.parentWidget.margin.top+this.parentWidget.margin.bottom).attr("viewBox","0 0 "+this.parentWidget.svgContainerWidth+" "+(this.parentWidget.height+this.parentWidget.margin.top+this.parentWidget.margin.bottom)),this.parentWidget.svg.attr("transform","translate("+this.parentWidget.margin.left+", "+this.parentWidget.margin.top+")"),this.parentWidget.svg.select(".svg-metrics__x-axis").remove(),this.parentWidget.svg.append("g").attr("class","svg-metrics__x-axis").attr("transform","translate(0, "+this.parentWidget.height+")")},Chart.prototype.svgConfig=function(t){var e=this.container.querySelector(".metrics-chart");this.parentWidget.svgContainerWidth=e&&e.clientWidth,this.parentWidget.margin={top:20,right:5,bottom:t.bottom,left:t.left},this.parentWidget.width=this.parentWidget.svgContainerWidth-this.parentWidget.margin.left-this.parentWidget.margin.right,this.parentWidget.height=200-this.parentWidget.margin.top-this.parentWidget.margin.bottom},Chart.prototype.content=function(){var t=this;if(this.parentWidget.valueLine=Object(a.i)().x((function(e){return t.parentWidget.xScale(t.chartUtils.parsedDate(e.month?e.month:e.day))})).y((function(e){return t.parentWidget.yScale(e.count)})).curve(a.c),this.nav.setNavIndex(),this.chartUtils.emptyDataCheck(),!this.chartUtils.isEmptyData){var e=this.parentWidget.dataDates.slice(0,this.chartUtils.selectedPeriod+1),i=JSON.parse(JSON.stringify(e)),s=this.parentWidget.data.dataSections[this.nav.index].color;i.forEach((function(t){return t.count=0})),this.oneDotCheck(),this.parentWidget.svg.append("path").raise().data([i]).style("opacity",0).attr("class","line line--"+this.nav.navTitle+" line--"+s).attr("d",this.parentWidget.valueLine).data([e]).transition().duration(750).style("opacity",(function(e){return t.isOneDot?0:1})).ease(a.d).attr("d",this.parentWidget.valueLine).attr("stroke-width","3").attr("fill","transparent").attr("stroke-linecap","round").attr("stroke",(function(e){return t.isOneDot?"transparent":t.inlineStyle(".line--"+t.nav.navTitle,"stroke")})),this.parentWidget.svg.append("g").attr("class","dots dots--"+this.nav.navTitle+" dots--"+s).selectAll(".dot").data(this.parentWidget.dataDates.slice(0,this.chartUtils.selectedPeriod+1)).enter().append("circle").attr("class","dot dot--"+this.nav.navTitle+" "+(this.isOneDot?"one-dot":"")).attr("cx",(function(e){return t.parentWidget.xScale(t.chartUtils.parsedDate(e.month?e.month:e.day))})).attr("cy",(function(e){return t.parentWidget.yScale(e.count)})).attr("r",this.isOneDot?3:5).attr("data-month",(function(t){return t.month?t.month:t.day})).attr("data-count",(function(t){return t.count})).attr("fill",(function(e){return t.isOneDot?t.inlineStyle(".line--"+t.nav.navTitle,"stroke"):"transparent"})),this.container.querySelector("."+this.selector).classList.contains("numeric-metrics")&&this.legends(),this.parentWidget.chartTooltip(this.nav.navTitle,this.parentWidget.data)}},Chart.prototype.oneDotCheck=function(){this.isOneDot=this.parentWidget.dataDates&&1===this.parentWidget.dataDates.length},Chart.prototype.eventUpdate=function(){this.parentWidget.svgContainerWidth=this.container.querySelector(".metrics-chart").clientWidth,this.parentWidget.width=this.parentWidget.svgContainerWidth-this.parentWidget.margin.left-this.parentWidget.margin.right,this.parentWidget.svg=Object(a.m)(this.container.querySelector(".metrics-chart__svg g"))},Chart.prototype.update=function(t){var e=this;this.chartUtils.anyHasData=!1,t.forEach((function(t){e.nav.navTitle=t,e.chartUtils.firstNDays(),e.chartUtils.dataUpdate(),e.chartUtils.emptyDataCheck(),e.chartUtils.emptyDataToggleMsg(),e.chartUtils.isEmptyData||(e.chartUtils.setPeriod(),e.chartUtils.setStartEndDate(),e.chartUtils.setMaxCount(),e.chartUtils.setDateFormat(),e.chartUtils.setAxisTicks(),e.svgApplyConfig(),e.chartUtils.scales(),e.chartUtils.axises(),e.parentWidget.svg.select(".svg-metrics__y-axis").transition(Object(a.q)().duration(300)).call(e.customYAxis.bind(e)),e.parentWidget.svg.select(".svg-metrics__x-axis").transition(Object(a.q)().duration(300)).call(e.customXAxis.bind(e)),e.content())}))},Chart.prototype.legends=function(){var t=0,e=this.parentWidget.data.dataSections[this.parentWidget.dataSectionIndex].title;if(this.container.querySelectorAll(".legends").forEach((function(e){return t+=e.getBoundingClientRect().width+15})),!this.container.querySelector(".legends--"+this.nav.navTitle)){var i=this.parentWidget.svg.append("g").attr("class","legends legends--"+this.nav.navTitle).attr("transform",(function(e){return"translate("+t+", -5)"}));i.append("rect").attr("rx",1.5).attr("ry",1.5).attr("x",-20).attr("y",-6).attr("width",15).attr("height",3).attr("fill",this.inlineStyle(".line--"+this.nav.navTitle,"stroke")),i.append("text").attr("y",0).attr("x",0).attr("font-size","14px").text(e).attr("fill",this.inlineStyle(".line--"+this.nav.navTitle,"stroke"))}},Chart.prototype.customYAxis=function(t){t.call(this.parentWidget.y_axis),t.selectAll(".tick line").attr("x1",10).attr("stroke",this.inlineStyle(".svg-metrics__y-axis line","stroke")),t.selectAll(".tick text").attr("x",5).attr("font-size","12px").attr("fill",this.inlineStyle(".svg-metrics__y-axis text","fill")),t.selectAll(".domain").attr("stroke",this.inlineStyle(".svg-metrics__y-axis path","stroke"))},Chart.prototype.customXAxis=function(t){t.call(this.parentWidget.x_axis);var e=this.chartUtils.isfirstNDays||this.parentWidget.svgContainerWidth<960&&this.chartUtils.datesTicks>6||"total"===this.parentWidget.dataPeriod&&this.chartUtils.selectedPeriod>0,i=this.chartUtils.isTotalTab||this.chartUtils.isfirstNDays?"20":"10";t.selectAll("text").attr("fill",this.inlineStyle(".svg-metrics__x-axis text","fill")).attr("transform",e?"translate(0 "+i+") rotate(40)":"translate(0 5)"),t.selectAll("line").attr("stroke",this.inlineStyle(".svg-metrics__x-axis line","stroke")),t.selectAll("path").attr("stroke",this.inlineStyle(".svg-metrics__x-axis path","stroke"))},Chart.prototype.inlineStyle=function(t,e){return window.getComputedStyle(this.container.querySelector(t),null).getPropertyValue(e)},Chart.prototype.downloadCSV=function(){var t="data:text/csv;charset=utf-8,",e=[],i=this.container.querySelector("."+this.selector+" .metrics-menu__dropdown-item--CSV > .metrics-menu__dropdown-link"),s=this.parentWidget.data,r=s.publicationTitle+".csv",n=Object(a.n)("%Y-%m");if(s.dataSections.length>0){for(var o=0;o<s.dataSections.length;o++)for(var h=0;h<s.dataSections[o].months.length;h++){var c=this.chartUtils.parsedDate(s.dataSections[o].months[h].month);e.push(s.dataSections[o].title+","+n(c)+","+s.dataSections[o].months[h].count)}t+=e.join("\r\n");var l=encodeURI(t);if(window.navigator.msSaveOrOpenBlob){var d=new Blob([t]);i.addEventListener("click",(function(t){return window.navigator.msSaveOrOpenBlob(d,r)}))}else i.setAttribute("href",l),i.setAttribute("download",r)}else i.setAttribute("title","Not enough data")},Chart.prototype.downloadPNG=function(){var t=this,e=(new XMLSerializer).serializeToString(this.container.querySelector(".metrics-chart__svg"));e=(e=e.replace(/(\w+)?:?xlink=/g,"xmlns:xlink=")).replace(/NS\d+:href/g,"xlink:href");var i=this.selector,s=Object(a.m)(this.container).select("."+i+" .metrics-chart").append("a").classed(".metrics-menu__dropdown-link",!0).node(),r=(new Blob([e],{type:"image/svg+xml;charset=utf-8"}),"data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(e)))),n=Object(a.m)(this.container).select("."+i+" .metrics-chart").append("img").classed("metrics-chart__export-img",!0).node();n.src=r,n.onload=function(a){var o=document.createElement("canvas"),h=o.getContext("2d",{alpha:!1}),c=window.getComputedStyle(t.container.querySelector("."+i+" .metrics-chart__svg"),null).getPropertyValue("fill"),l=t.parentWidget.data.publicationTitle+".png";URL.revokeObjectURL(r),o.height=200,o.width=t.parentWidget.svgContainerWidth,h.clearRect(0,0,o.width,o.height),h.fillStyle=c,h.fillRect(0,0,o.width,o.height),h.drawSvg(e,0,0,o.width,o.height),window.navigator.msSaveOrOpenBlob?s.onclick=function(){window.navigator.msSaveOrOpenBlob(o.msToBlob(),l)}:(s.setAttribute("href",o.toDataURL()),s.setAttribute("download",l),s.setAttribute("target","_blank")),s.click(),s.remove(),o.remove(),n.remove()}},Chart.prototype.reset=function(t){var e=this;this.parentWidget.svg.selectAll("path.line--"+t.currentTarget.dataset.title).transition().duration(300).style("opacity",0).remove(),this.container.querySelectorAll("path.line").forEach((function(t){return t.remove()})),this.container.querySelectorAll(".dots").forEach((function(t){return t.remove()})),this.container.querySelectorAll(".legends").forEach((function(t){return t.remove()}));var i=this.parentWidget.data;this.parentWidget.selectedSections=[];var a=[];this.parentWidget.selectedTabs.forEach((function(t){a.push(t.dataset.title),e.parentWidget.selectedSections.push(i.dataSections[i.dataSections.map((function(t){return t.id})).indexOf(t.dataset.title)])})),this.update(a),this.chartUtils.emptyDataToggleMsg()},Chart}();e.a=r},396:function(t,e,i){"use strict";var a=i(266),__awaiter=function(t,e,i,a){return new(i||(i=Promise))((function(s,r){function fulfilled(t){try{step(a.next(t))}catch(t){r(t)}}function rejected(t){try{step(a.throw(t))}catch(t){r(t)}}function step(t){t.done?s(t.value):function adopt(t){return t instanceof i?t:new i((function(e){e(t)}))}(t.value).then(fulfilled,rejected)}step((a=a.apply(t,e||[])).next())}))},__generator=function(t,e){var i,a,s,r,n={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return r={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function verb(r){return function(o){return function step(r){if(i)throw new TypeError("Generator is already executing.");for(;n;)try{if(i=1,a&&(s=2&r[0]?a.return:r[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,r[1])).done)return s;switch(a=0,s&&(r=[2&r[0],s.value]),r[0]){case 0:case 1:s=r;break;case 4:return n.label++,{value:r[1],done:!1};case 5:n.label++,a=r[1],r=[0];continue;case 7:r=n.ops.pop(),n.trys.pop();continue;default:if(!(s=n.trys,(s=s.length>0&&s[s.length-1])||6!==r[0]&&2!==r[0])){n=0;continue}if(3===r[0]&&(!s||r[1]>s[0]&&r[1]<s[3])){n.label=r[1];break}if(6===r[0]&&n.label<s[1]){n.label=s[1],s=r;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(r);break}s[2]&&n.ops.pop(),n.trys.pop();continue}r=e.call(t,n)}catch(t){r=[6,t],a=0}finally{i=s=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,o])}}},s=function(){function ChartUtils(t,e,i,s){this.container=t,this.selector=e,this.parentWidget=i,this.nav=s,this.maxCount=0,this.selectedPeriod=0,this.parsedDate=Object(a.p)("%Y-%m-%d"),this.dateBegin="",this.dateEnd="",this.datesTicks=" ",this.yTicks=0,this.monthsCount=0,this.dataPeriod="",this.dataDays=0,this.isSmall=!1,this.isfirstNDays=!1,this.isTotalTab=!1,this.isEmptyData=!1,this.anyHasData=!1,this.dateFormat=null,this.translations=null}return ChartUtils.prototype.init=function(){this.translations=UX.i18n.localizedObject("articleMetrics"),this.smallSize(),this.icons={share:{shares:'<svg width="14" height="12" viewBox="0 0 14 12"><path d="M8.5 3.8v-3L13.8 6l-5.3 5.3V8.2C4.7 8.2 2.1 9.4.2 12c.8-3.8 3-7.5 8.3-8.3z"/></svg>',comments:'<svg width="14" height="14" viewBox="0 0 14 14"><path d="M13.7 1.7c0-.8-.6-1.4-1.4-1.4H1.7C.9.3.3 1 .3 1.7v8c0 .7.6 1.3 1.4 1.3H11l2.7 2.7v-12zM11 8.3H3V7h8v1.3zm0-2H3V5h8v1.3zm0-2H3V3h8v1.3z"/></svg>',likes:'<svg width="14" height="13" viewBox="0 0 14 13"><path d="M.6 12.3h2.3v-7H.6v7zm12.8-6.5c0-.6-.5-1.1-1.1-1.1H8.6L9 2v-.2c0-.2 0-.4-.2-.6L8.3.6 4.4 4.4c-.2.2-.3.5-.3.9V11c0 .6.5 1.2 1.2 1.2h5.2c.5 0 .9-.3 1-.8l1.8-4 .1-.5V5.9z"/></svg>',loves:'<svg width="14" height="13" viewBox="0 0 14 13"><path d="M7 12.2l-1-.8C2.6 8.2.3 6.2.3 3.7.3 1.7 2 0 4 0a4 4 0 013 1.4A4 4 0 0110 0c2 0 3.7 1.6 3.7 3.7 0 2.5-2.3 4.5-5.7 7.7l-1 .8z"/></svg>',tweets:'<svg width="16" height="10" viewBox="0 0 16 10"><path d="M3.3 3.3V8h7.2l1 1.3H2v-6H0L2.7 0l2.6 3.3h-2zM12.7 6V1.3H5.5L4.5 0H14v6h2l-2.7 3.3L10.7 6h2z"/></svg>'}}},ChartUtils.prototype.setPeriod=function(){var t=this.container.querySelector(".metrics-tabs__item-link.metrics-selected--js");this.parentWidget.dataPeriod=t&&t.dataset.title;var e={firstNDays:this.parentWidget.dataDates.length-1,last6:5,last12:11,total:this.parentWidget.dataDates.length-1};this.selectedPeriod=e[this.parentWidget.dataPeriod]},ChartUtils.prototype.setMaxCount=function(){var t,e,i=this,a=this.parentWidget.selectedSections;a.length&&!this.isEmptyData&&(a.forEach((function(a){i.setPeriod();var s=a.firstNDays?a.firstNDays:[];if((e=i.isfirstNDays?s:a.months).length>0){var r=e.slice(0,i.monthsCount+1).sort((function(t,e){return t.count<e.count?1:-1}))[0];(t<r.count||void 0===t)&&(t=r.count)}})),this.maxCount=t)},ChartUtils.prototype.setStartEndDate=function(){var t=this;if(this.parentWidget.selectedSections.length){var e,i,a;if(this.parentWidget.selectedSections.forEach((function(s,r){t.isfirstNDays&&s.firstNDays&&s.firstNDays.length?((e>t.parsedDate(s.firstNDays[s.firstNDays.length-1])||void 0===e)&&(e=t.parsedDate(s.firstNDays[s.firstNDays.length-1].day),a=r),(s.firstNDays.length>0&&t.isfirstNDays&&i<t.parsedDate(s.firstNDays[0].day)||t.isfirstNDays&&void 0===i)&&(i=t.parsedDate(s.firstNDays[0].day))):s.startDate&&!t.isfirstNDays&&(e>t.parsedDate(s.startDate)||void 0===e)&&(e=t.parsedDate(s.startDate),a=r)})),this.parentWidget.selectedSections[a].months.length>=this.selectedPeriod+1&&"total"!==this.parentWidget.dataPeriod&&"firstNDays"!==this.parentWidget.dataPeriod){var s=this.parsedDate(this.parentWidget.dataMonths[0]);s.setMonth(s.getMonth()-this.selectedPeriod),this.dateBegin=s,this.monthsCount=this.selectedPeriod+1}else this.dateBegin=e,this.monthsCount=this.isfirstNDays?this.parentWidget.selectedSections[a].firstNDays.length:this.parentWidget.selectedSections[a].months.length;this.isfirstNDays?this.dateEnd=i:this.dateEnd=this.parsedDate(this.parentWidget.dataMonths[0])}},ChartUtils.prototype.smallSize=function(){window.screen.width<960&&(this.isSmall=!0)},ChartUtils.prototype.emptyDataCheck=function(){this.dataUpdate(),0===this.parentWidget.dataDates.length?this.isEmptyData=!0:(this.isEmptyData=!1,this.anyHasData=!0)},ChartUtils.prototype.emptyDataToggleMsg=function(){var t=this.parentWidget.container.querySelector("."+this.selector+" .metrics-chart__empty");this.isEmptyData&&!this.anyHasData?t.classList.add("metrics-chart__empty--show"):t.classList.remove("metrics-chart__empty--show")},ChartUtils.prototype.scales=function(){this.parentWidget.yScale=Object(a.k)().domain([0,this.maxCount]).range([this.parentWidget.height,0]),this.parentWidget.xScale=Object(a.l)().domain([this.dateBegin,this.dateEnd]).range([20,this.parentWidget.width-10])},ChartUtils.prototype.firstNDays=function(){var t=this.parentWidget.container.querySelector(".metrics-tabs__item-link.metrics-selected--js");this.isfirstNDays=t&&"firstNDays"===t.dataset.title,this.isTotalTab=t&&"total"===t.dataset.title},ChartUtils.prototype.dataUpdate=function(){var t=this,e=this.parentWidget.data;this.parentWidget.dataSectionIndex=e.dataSections.map((function(t){return t.id})).indexOf(this.nav.navTitle);var i=e.dataSections[this.parentWidget.dataSectionIndex].firstNDays||[];this.parentWidget.dataDates=this.isfirstNDays?i:e.dataSections[this.parentWidget.dataSectionIndex].months,this.parentWidget.dataDates.sort((function(e,i){return t.parsedDate(i.month?i.month:i.day)-t.parsedDate(e.month?e.month:e.day)})),this.parentWidget.dataMonths=this.parentWidget.dataDates.map((function(t){return t.month?t.month:t.day}))},ChartUtils.prototype.setAxisTicks=function(){if(this.isfirstNDays){var t=this.dateBegin.getTime(),e=this.dateEnd.getTime();this.datesTicks=Math.floor((e-t)/864e5)}else{var i=this.dateBegin.getFullYear(),a=this.dateEnd.getFullYear(),s=this.dateBegin.getMonth(),r=this.dateEnd.getMonth();this.datesTicks=r+12*a-(s+12*i),this.datesTicks=r+12*a===s+12*i?1:this.datesTicks}this.datesTicks>14&&(this.datesTicks=7),this.maxCount<4&&this.maxCount>0?this.yTicks=this.maxCount:this.yTicks=4},ChartUtils.prototype.setDateFormat=function(){return __awaiter(this,void 0,void 0,(function(){var t,e;return __generator(this,(function(i){return t=this.translations.timeFormat,e=Object(a.o)(t),this.dateFormat=e.format("%b"),"total"===this.parentWidget.dataPeriod&&(this.dateFormat=e.format("%b %Y")),this.isfirstNDays&&(this.dateFormat=e.format("%d %b %Y")),[2]}))}))},ChartUtils.prototype.axises=function(){this.parentWidget.x_axis=Object(a.a)(this.parentWidget.xScale).tickFormat(this.dateFormat).scale(this.parentWidget.xScale).ticks(this.datesTicks),this.parentWidget.y_axis=Object(a.b)(this.parentWidget.yScale).scale(this.parentWidget.yScale).ticks(this.yTicks).tickFormat((function(t){return t.toLocaleString(navigator.language)})).tickSize(-this.parentWidget.width)},ChartUtils}();e.a=s}}]);
//# sourceMappingURL=4-79a8178ba3cb4bcd6057.js.map