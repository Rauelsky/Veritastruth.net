<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VERITAS - Veracity Engine</title>
    <link href="https://fonts.googleapis.com/css2?family=Antonio:wght@300;400;500;700&family=IBM+Plex+Sans:wght@400;500;600;700&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0a12;
            --bg-secondary: #0f172a;
            --bg-card: #1e3a5f;
            --bg-tertiary: #2d4a6f;
            --bg-input: #0a0a12;
            --accent-teal: #60a5fa;
            --accent-teal-dim: #3b82f6;
            --accent-cyan: #60a5fa;
            --accent-blue: #2196F3;
            --accent-green: #10b981;
            --accent-amber: #d4a853;
            --accent-red: #ef4444;
            --accent-purple: #667eea;
            --text-primary: #ffffff;
            --text-secondary: #bfdbfe;
            --text-muted: #60a5fa;
            --text-dim: #3b82f6;
            --border-subtle: #1e3a5f;
            --border-medium: #3b82f6;
            --track-a-bg: rgba(212, 168, 83, 0.5);
            --track-b-bg: rgba(102, 126, 234, 0.5);
            --track-c-bg: rgba(96, 165, 250, 0.5);
            --track-working-bg: rgba(16, 185, 129, 0.5);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'IBM Plex Sans', -apple-system, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            overflow-y: auto;
        }

        .lcars-container {
            display: grid;
            grid-template-columns: minmax(280px, 280px) 1fr;
            grid-template-rows: 60px 1fr 45px;
            min-height: 100vh;
            gap: 3px;
            padding: 3px;
            padding-bottom: 10px;
        }

        .top-bar {
            grid-column: 1 / -1;
            display: flex;
            align-items: stretch;
        }

        .top-bracket-left {
            width: 280px;
            background: linear-gradient(180deg, rgba(33, 150, 243, 0.6) 0%, rgba(25, 118, 210, 0.6) 100%);
            border-radius: 0 0 0 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            border: 1px solid rgba(96, 165, 250, 0.3);
            border-top: none;
        }

        .top-bracket-left span {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
            letter-spacing: 1px;
        }

        .top-middle {
            flex: 1;
            background: linear-gradient(180deg, rgba(30, 58, 95, 0.7) 0%, rgba(15, 23, 42, 0.7) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            border-bottom: 1px solid rgba(59, 130, 246, 0.4);
        }

        .top-middle span {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-primary);
            letter-spacing: 4px;
        }

        .language-selector {
            position: relative;
        }
        
        .language-selector select {
            background: rgba(15, 23, 42, 0.9);
            color: var(--text-primary);
            border: 1px solid var(--accent-teal);
            border-radius: 6px;
            padding: 6px 12px;
            font-size: 14px;
            font-family: 'IBM Plex Sans', sans-serif;
            cursor: pointer;
            outline: none;
            transition: all 0.3s ease;
            min-width: 140px;
        }
        
        .language-selector select:hover {
            border-color: var(--accent-amber);
            box-shadow: 0 0 10px rgba(212, 168, 83, 0.3);
        }
        
        .language-selector select:focus {
            border-color: var(--accent-amber);
            box-shadow: 0 0 15px rgba(212, 168, 83, 0.5);
        }
        
        .language-selector select option {
            background: var(--bg-secondary);
            color: var(--text-primary);
            padding: 8px;
        }

        .top-bracket-right {
            width: 160px;
            background: linear-gradient(180deg, rgba(33, 150, 243, 0.6) 0%, rgba(25, 118, 210, 0.6) 100%);
            border-radius: 0 0 30px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid rgba(96, 165, 250, 0.3);
            border-top: none;
            cursor: pointer;
            transition: filter 0.2s;
        }

        .top-bracket-right:hover { filter: brightness(1.2); }

        .top-bracket-right span {
            font-size: 12px;
            font-weight: 500;
            color: var(--text-secondary);
            letter-spacing: 1px;
        }

        /* TOS Bridge Audio Toggle - Bottom Right Corner */
        .audio-toggle-corner {
            width: 100%;
            height: 100%;
            background-image: url('/images/speaker-grill.webp');
            background-size: cover;
            background-position: center;
            border-radius: 0 0 26px 0;
            cursor: pointer;
            transition: all 0.3s ease;
            opacity: 0.6;
            position: relative;
        }
        .audio-toggle-corner:hover {
            opacity: 0.9;
            box-shadow: inset 0 0 30px rgba(96, 165, 250, 0.5);
        }
        .audio-toggle-corner.playing {
            opacity: 1;
            box-shadow: 
                inset 0 0 30px rgba(96, 165, 250, 0.6),
                0 0 20px rgba(96, 165, 250, 0.4);
            animation: speaker-glow 2s ease-in-out infinite;
        }
        
        @keyframes speaker-glow {
            0%, 100% { 
                box-shadow: inset 0 0 30px rgba(96, 165, 250, 0.6), 0 0 20px rgba(96, 165, 250, 0.4);
            }
            50% { 
                box-shadow: inset 0 0 40px rgba(147, 197, 253, 0.8), 0 0 35px rgba(96, 165, 250, 0.6);
            }
        }
        
        /* Bottom bar horizontal logo */
        .bottom-logo {
            height: 28px;
            width: auto;
            opacity: 0.8;
        }

        /* ==================== WARP CORE PULSE RACEWAY ==================== */
        /* The pulse travels: bottom → up sidebar → around elbow → left along top bar */
        
        .warp-pulse-container {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: 50;
            overflow: hidden;
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        
        .warp-pulse-container.active {
            opacity: 1;
        }
        
        /* Pulse traveling up the sidebar spine */
        .warp-pulse-spine {
            position: absolute;
            right: 0;
            top: 45px;
            bottom: 45px;
            width: 35px;
            overflow: hidden;
        }
        
        .warp-pulse-spine::before {
            content: '';
            position: absolute;
            left: 0;
            right: 0;
            height: 80px;
            background: linear-gradient(to top,
                transparent 0%,
                rgba(96, 165, 250, 0.3) 20%,
                rgba(147, 197, 253, 0.8) 45%,
                rgba(200, 220, 255, 1) 50%,
                rgba(147, 197, 253, 0.8) 55%,
                rgba(96, 165, 250, 0.3) 80%,
                transparent 100%
            );
            animation: pulse-up-spine 2s ease-in-out infinite;
            box-shadow: 0 0 30px rgba(147, 197, 253, 0.8);
        }
        
        @keyframes pulse-up-spine {
            0% { 
                bottom: -80px;
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            70% {
                opacity: 1;
            }
            80% {
                bottom: calc(100% + 80px);
                opacity: 0;
            }
            100% {
                bottom: calc(100% + 80px);
                opacity: 0;
            }
        }
        
        /* Pulse going around the top curve/elbow */
        .warp-pulse-top-curve {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 45px;
            overflow: hidden;
        }
        
        .warp-pulse-top-curve::before {
            content: '';
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100px;
            background: linear-gradient(to left,
                transparent 0%,
                rgba(96, 165, 250, 0.3) 20%,
                rgba(147, 197, 253, 0.8) 45%,
                rgba(200, 220, 255, 1) 50%,
                rgba(147, 197, 253, 0.8) 55%,
                rgba(96, 165, 250, 0.3) 80%,
                transparent 100%
            );
            animation: pulse-along-top 2s ease-in-out infinite;
            box-shadow: 0 0 30px rgba(147, 197, 253, 0.8);
        }
        
        @keyframes pulse-along-top {
            0%, 60% {
                right: -100px;
                opacity: 0;
            }
            70% {
                right: -100px;
                opacity: 1;
            }
            95% {
                right: 100%;
                opacity: 1;
            }
            100% {
                right: 100%;
                opacity: 0;
            }
        }
        
        /* Bottom entry pulse */
        .warp-pulse-bottom {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 45px;
            overflow: hidden;
        }
        
        .warp-pulse-bottom::before {
            content: '';
            position: absolute;
            top: 0;
            bottom: 0;
            width: 80px;
            background: linear-gradient(to right,
                transparent 0%,
                rgba(96, 165, 250, 0.3) 20%,
                rgba(147, 197, 253, 0.8) 45%,
                rgba(200, 220, 255, 1) 50%,
                rgba(147, 197, 253, 0.8) 55%,
                rgba(96, 165, 250, 0.3) 80%,
                transparent 100%
            );
            animation: pulse-along-bottom 2s ease-in-out infinite;
            box-shadow: 0 0 30px rgba(147, 197, 253, 0.8);
        }
        
        @keyframes pulse-along-bottom {
            0% {
                left: -80px;
                opacity: 1;
            }
            15% {
                left: calc(100% - 35px);
                opacity: 1;
            }
            20%, 100% {
                left: calc(100% - 35px);
                opacity: 0;
            }
        }

        /* Top bar pulse continuation */
        .warp-pulse-topbar {
            position: fixed;
            top: 3px;
            left: 3px;
            right: 3px;
            height: 60px;
            pointer-events: none;
            z-index: 1001;
            overflow: hidden;
            opacity: 0;
            transition: opacity 0.5s ease;
            border-radius: 0 0 30px 30px;
        }
        
        .warp-pulse-topbar.active {
            opacity: 1;
        }
        
        .warp-pulse-topbar::before {
            content: '';
            position: absolute;
            top: 0;
            bottom: 0;
            width: 120px;
            background: linear-gradient(to left,
                transparent 0%,
                rgba(96, 165, 250, 0.2) 20%,
                rgba(147, 197, 253, 0.6) 45%,
                rgba(200, 220, 255, 0.9) 50%,
                rgba(147, 197, 253, 0.6) 55%,
                rgba(96, 165, 250, 0.2) 80%,
                transparent 100%
            );
            animation: pulse-across-topbar 2s ease-in-out infinite;
            box-shadow: 0 0 40px rgba(147, 197, 253, 0.6);
        }
        
        @keyframes pulse-across-topbar {
            0%, 75% {
                right: -120px;
                opacity: 0;
            }
            80% {
                right: -120px;
                opacity: 1;
            }
            98% {
                right: 100%;
                opacity: 1;
            }
            100% {
                right: 100%;
                opacity: 0;
            }
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 0;
            position: relative;
            min-width: 250px;
            overflow: hidden;
        }

        .sidebar-top-curve {
            background: linear-gradient(180deg, rgba(59, 130, 246, 0.5) 0%, rgba(47, 109, 215, 0.47) 100%);
            height: 45px;
            border-radius: 0 30px 0 0;
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-bottom: none;
            margin-right: 0;
        }

        .sidebar-spine {
            position: absolute;
            right: 0;
            top: 45px;
            bottom: 45px;
            width: 35px;
            background: linear-gradient(180deg, rgba(47, 109, 215, 0.47) 0%, rgba(25, 50, 85, 0.52) 100%);
            border-right: 1px solid rgba(59, 130, 246, 0.3);
        }
        
        .sidebar-elbow {
            position: absolute;
            right: 0;
            bottom: 0;
            width: 35px;
            height: 45px;
            background: linear-gradient(180deg, rgba(25, 50, 85, 0.52) 0%, rgba(15, 23, 42, 0.55) 100%);
            border-radius: 0 0 30px 0;
            border-right: 1px solid rgba(59, 130, 246, 0.3);
            border-bottom: 1px solid rgba(59, 130, 246, 0.3);
        }

        .sidebar-buttons {
            display: flex;
            flex-direction: column;
            gap: 3px;
            flex: 1;
            overflow-y: auto;
            padding: 3px 38px 3px 0;
        }

        .sidebar-row {
            display: flex;
            gap: 2px;
            height: 52px;
        }

        .sidebar-label {
            flex: 1 0 80px;
            max-width: 120px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding: 0 10px 0 8px;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-primary);
            letter-spacing: 0.5px;
            border-radius: 14px 0 0 14px;
            cursor: pointer;
            transition: filter 0.2s;
            border: 1px solid rgba(255,255,255,0.05);
            border-right: none;
            overflow: hidden;
            white-space: nowrap;
        }

        .sidebar-label:hover { filter: brightness(1.3); }

        .sidebar-label.history { background: linear-gradient(180deg, rgba(212, 168, 83, 0.6) 0%, rgba(170, 134, 66, 0.6) 100%); }
        .sidebar-label.science { background: linear-gradient(180deg, rgba(13, 148, 136, 0.6) 0%, rgba(10, 118, 108, 0.6) 100%); }
        .sidebar-label.philosophy { background: linear-gradient(180deg, rgba(102, 126, 234, 0.6) 0%, rgba(118, 75, 162, 0.6) 100%); }
        .sidebar-label.logic { background: linear-gradient(180deg, rgba(59, 130, 246, 0.6) 0%, rgba(37, 99, 235, 0.6) 100%); }
        .sidebar-label.rhetoric { background: linear-gradient(180deg, rgba(118, 75, 162, 0.6) 0%, rgba(88, 56, 121, 0.6) 100%); }
        .sidebar-label.media { background: linear-gradient(180deg, rgba(33, 150, 243, 0.6) 0%, rgba(25, 118, 210, 0.6) 100%); }
        .sidebar-label.psychology { background: linear-gradient(180deg, rgba(20, 184, 166, 0.6) 0%, rgba(13, 148, 136, 0.6) 100%); }
        .sidebar-label.statistics { background: linear-gradient(180deg, rgba(96, 165, 250, 0.6) 0%, rgba(59, 130, 246, 0.6) 100%); }
        .sidebar-label.sources { background: linear-gradient(180deg, rgba(212, 168, 83, 0.6) 0%, rgba(180, 142, 70, 0.6) 100%); }
        .sidebar-label.export { background: linear-gradient(180deg, rgba(100, 116, 139, 0.6) 0%, rgba(71, 85, 105, 0.6) 100%); }

        /* ==================== SALIENCE GLOW SYSTEM ==================== */
        /* Only activates when salience-* classes are added to buttons */
        /* Default buttons remain unchanged until classifier adds classes */
        
        /* HIGH SALIENCE - Strong breathing glow */
        .sidebar-label.salience-high,
        .sidebar-action.salience-high {
            animation: glow-breathe-high 2s ease-in-out infinite;
            z-index: 10;
        }
        
        @keyframes glow-breathe-high {
            0%, 100% { 
                filter: brightness(1.0);
                box-shadow: 0 0 5px rgba(255, 200, 100, 0.4);
            }
            50% { 
                filter: brightness(1.6);
                box-shadow: 
                    0 0 15px rgba(255, 220, 150, 0.9),
                    0 0 30px rgba(255, 200, 100, 0.6);
            }
        }
        
        /* MEDIUM SALIENCE - Gentle breathing */
        .sidebar-label.salience-medium,
        .sidebar-action.salience-medium {
            animation: glow-breathe-medium 3s ease-in-out infinite;
        }
        
        @keyframes glow-breathe-medium {
            0%, 100% { 
                filter: brightness(0.85);
                box-shadow: none;
            }
            50% { 
                filter: brightness(1.35);
                box-shadow: 0 0 12px rgba(255, 200, 100, 0.6);
            }
        }
        
        /* LOW SALIENCE - Subtle pulse */
        .sidebar-label.salience-low,
        .sidebar-action.salience-low {
            animation: glow-breathe-low 4s ease-in-out infinite;
        }
        
        @keyframes glow-breathe-low {
            0%, 100% { 
                filter: brightness(0.7);
            }
            50% { 
                filter: brightness(1.1);
                box-shadow: 0 0 8px rgba(255, 200, 100, 0.4);
            }
        }
        
        /* NO SALIENCE - Dimmed (when classifier explicitly dims a button) */
        .sidebar-label.salience-none,
        .sidebar-action.salience-none {
            filter: brightness(0.5);
            opacity: 0.6;
        }

        .sidebar-number {
            background: var(--bg-input);
            width: 54px;
            flex: 0 0 54px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 3px;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 15px;
            font-weight: 600;
            color: var(--accent-amber);
            border: 1px solid var(--border-medium);
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
            cursor: help;
            position: relative;
        }
        
        /* Auto-scale font for longer numbers */
        .sidebar-number.compact {
            font-size: 12px;
            letter-spacing: -0.5px;
        }

        .sidebar-action {
            width: 85px;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding: 0 10px 0 0;
            font-size: 10px;
            font-weight: 600;
            color: var(--text-primary);
            letter-spacing: 0.5px;
            cursor: pointer;
            transition: filter 0.2s;
            border-radius: 0 6px 6px 0;
            border: 1px solid rgba(255,255,255,0.05);
            border-left: none;
            position: relative;
        }

        .sidebar-action:hover { filter: brightness(1.3); }

        .sidebar-action.archives { background: linear-gradient(180deg, rgba(200, 145, 70, 0.35) 0%, rgba(150, 105, 45, 0.35) 100%); }
        .sidebar-action.research { background: linear-gradient(180deg, rgba(20, 140, 115, 0.35) 0%, rgba(12, 95, 80, 0.35) 100%); }
        .sidebar-action.ethics { background: linear-gradient(180deg, rgba(115, 95, 165, 0.35) 0%, rgba(80, 60, 130, 0.35) 100%); }
        .sidebar-action.fallacies { background: linear-gradient(180deg, rgba(85, 115, 175, 0.35) 0%, rgba(55, 80, 140, 0.35) 100%); }
        .sidebar-action.persuasion { background: linear-gradient(180deg, rgba(170, 95, 135, 0.35) 0%, rgba(125, 65, 100, 0.35) 100%); }
        .sidebar-action.literacy { background: linear-gradient(180deg, rgba(180, 85, 85, 0.35) 0%, rgba(135, 55, 55, 0.35) 100%); }
        .sidebar-action.bias { background: linear-gradient(180deg, rgba(75, 145, 165, 0.35) 0%, rgba(50, 110, 130, 0.35) 100%); }
        .sidebar-action.data { background: linear-gradient(180deg, rgba(95, 105, 175, 0.35) 0%, rgba(65, 72, 140, 0.35) 100%); }
        .sidebar-action.verify { background: linear-gradient(180deg, rgba(200, 155, 60, 0.35) 0%, rgba(150, 115, 35, 0.35) 100%); }
        .sidebar-action.reports { background: linear-gradient(180deg, rgba(115, 125, 135, 0.35) 0%, rgba(80, 90, 100, 0.35) 100%); }

        .sidebar-divider {
            height: 5px;
            margin: 8px 0;
            background: linear-gradient(90deg, var(--accent-teal-dim) 0%, transparent 100%);
            border-radius: 2px;
        }

        .sidebar-bottom-curve {
            background: linear-gradient(180deg, rgba(25, 50, 85, 0.52) 0%, rgba(15, 23, 42, 0.55) 100%);
            height: 45px;
            border-radius: 0 0 0 30px;
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-top: none;
            border-right: none;
            margin-right: 35px;
            position: relative;
            z-index: 2;
        }

        .main-area {
            display: flex;
            flex-direction: column;
            gap: 3px;
            padding-left: 3px;
        }

        .clock-row {
            display: flex;
            gap: 0;
            height: clamp(60px, 8vw, 85px);
            align-items: center;
            justify-content: space-between;
        }

        .veracity-logo-row {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            flex: 0 1 auto;
            padding: 0 8px;
        }

        .veracity-logo-img {
            height: clamp(50px, 7vw, 75px);
            width: auto;
            object-fit: contain;
        }

        .clock-left-group {
            display: flex;
            gap: 0;
            height: 100%;
            align-items: center;
        }

        .clock-left-bar {
            display: flex;
            flex-direction: column;
            gap: 3px;
            flex: 0 0 auto;
            width: clamp(80px, 9vw, 100px);
            height: 100%;
        }

        .clock-left-btn {
            background: linear-gradient(180deg, rgba(212, 168, 83, 0.4) 0%, rgba(170, 134, 66, 0.4) 100%);
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(7px, 0.8vw, 9px);
            font-weight: 600;
            color: var(--text-secondary);
            letter-spacing: 0.5px;
            border-radius: 10px 0 0 10px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid rgba(255,255,255,0.05);
            white-space: nowrap;
        }

        .clock-left-btn:hover { filter: brightness(1.3); }
        .clock-left-btn.teal { background: linear-gradient(180deg, rgba(20, 184, 166, 0.4) 0%, rgba(13, 148, 136, 0.4) 100%); }

        .clock-frame {
            background: linear-gradient(180deg, rgba(30, 58, 95, 0.5) 0%, rgba(15, 23, 42, 0.5) 100%);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-left: none;
            border-radius: 0 8px 8px 0;
            padding: 8px 16px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
            height: 100%;
            min-width: clamp(140px, 18vw, 200px);
        }

        .clock-time {
            font-family: 'IBM Plex Mono', monospace;
            font-size: clamp(20px, 3vw, 32px);
            font-weight: 400;
            color: var(--accent-amber);
            letter-spacing: clamp(1px, 0.15vw, 1.5px);
            line-height: 1;
            white-space: nowrap;
        }

        .clock-time.processing {
            color: var(--accent-green);
            animation: pulse 0.5s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }

        .clock-subtext {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1px;
        }

        .clock-subtext span {
            font-size: clamp(7px, 0.75vw, 9px);
            color: var(--text-muted);
            letter-spacing: clamp(0.5px, 0.1vw, 1px);
            white-space: nowrap;
        }

        .track-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: clamp(2px, 0.4vw, 5px);
            flex: 0 0 auto;
            width: clamp(100px, 14vw, 160px);
        }

        .track-btn {
            height: clamp(24px, 3vw, 34px);
            border-radius: 7px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(7px, 0.8vw, 9px);
            font-weight: 600;
            color: var(--text-secondary);
            letter-spacing: clamp(0.5px, 0.1vw, 1px);
            cursor: pointer;
            transition: all 0.3s;
            opacity: 0.5;
            border: 1px solid rgba(255,255,255,0.08);
            box-shadow: 0 2px 0 rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.1);
            white-space: nowrap;
        }

        .track-btn.active {
            opacity: 1;
            color: var(--text-primary);
            box-shadow: 0 0 15px currentColor, 0 2px 0 rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.15);
        }

        .track-btn.track-a { background: linear-gradient(180deg, rgba(212, 168, 83, 0.5) 0%, rgba(170, 134, 66, 0.5) 100%); }
        .track-btn.track-a.active { background: linear-gradient(180deg, rgba(212, 168, 83, 0.85) 0%, rgba(170, 134, 66, 0.85) 100%); box-shadow: 0 0 20px rgba(212, 168, 83, 0.6); }
        .track-btn.track-b { background: linear-gradient(180deg, rgba(118, 75, 162, 0.5) 0%, rgba(88, 56, 121, 0.5) 100%); }
        .track-btn.track-b.active { background: linear-gradient(180deg, rgba(118, 75, 162, 0.85) 0%, rgba(88, 56, 121, 0.85) 100%); box-shadow: 0 0 20px rgba(118, 75, 162, 0.6); }
        .track-btn.track-c { background: linear-gradient(180deg, rgba(20, 184, 166, 0.5) 0%, rgba(13, 148, 136, 0.5) 100%); }
        .track-btn.track-c.active { background: linear-gradient(180deg, rgba(20, 184, 166, 0.85) 0%, rgba(13, 148, 136, 0.85) 100%); box-shadow: 0 0 20px rgba(20, 184, 166, 0.6); }
        .track-btn.working { background: linear-gradient(180deg, rgba(59, 130, 246, 0.5) 0%, rgba(37, 99, 235, 0.5) 100%); }
        .track-btn.working.active { background: linear-gradient(180deg, rgba(59, 130, 246, 0.85) 0%, rgba(37, 99, 235, 0.85) 100%); box-shadow: 0 0 20px rgba(59, 130, 246, 0.6); animation: pulse 0.5s ease-in-out infinite; }

        .status-row {
            display: flex;
            gap: 3px;
            height: 22px;
        }

        .status-bar {
            background: linear-gradient(180deg, rgba(200, 145, 70, 0.3) 0%, rgba(150, 105, 45, 0.3) 100%);
            flex: 1;
            display: flex;
            align-items: center;
            padding: 0 12px;
            font-size: 9px;
            font-weight: 500;
            color: var(--text-secondary);
            letter-spacing: 1px;
            border-radius: 4px;
            border: 1px solid rgba(255,255,255,0.05);
        }

        .status-bar.right { justify-content: flex-end; }
        .status-bar.teal { background: linear-gradient(180deg, rgba(20, 140, 115, 0.3) 0%, rgba(12, 95, 80, 0.3) 100%); }
        .status-bar.purple { background: linear-gradient(180deg, rgba(115, 95, 165, 0.3) 0%, rgba(80, 60, 130, 0.3) 100%); }

        .content-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--bg-card);
            border: 1px solid var(--accent-teal-dim);
            border-radius: 12px;
            overflow: hidden;
            position: relative;
        }

        .content-header {
            background: var(--bg-tertiary);
            padding: 10px 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 30px;
            border-bottom: 1px solid var(--border-subtle);
            position: relative;
        }

        .content-header h2 {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
            letter-spacing: 2px;
        }

        .content-header .version {
            font-size: 10px;
            color: var(--text-muted);
        }

        .content-body {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 20px 25px;
            gap: 15px;
            overflow-y: auto;
        }

        .factoid-display {
            display: none;
            padding: 16px;
            background: var(--bg-tertiary);
            border: 1px solid var(--accent-amber);
            border-left: 3px solid var(--accent-amber);
            border-radius: 8px;
            animation: fadeIn 0.3s ease;
        }

        .factoid-display.visible { display: block; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .factoid-category {
            font-size: 9px;
            font-weight: 600;
            color: var(--accent-amber);
            letter-spacing: 2px;
            margin-bottom: 8px;
        }

        .factoid-text {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .factoid-close {
            margin-top: 12px;
            font-size: 10px;
            color: var(--text-muted);
            cursor: pointer;
            transition: color 0.2s;
        }

        .factoid-close:hover { color: var(--text-primary); }

        .input-section {
            display: flex;
            flex-direction: column;
            gap: 12px;
            align-items: center;
        }

        .input-label {
            font-size: 11px;
            font-weight: 500;
            color: var(--text-secondary);
            letter-spacing: 2px;
            text-align: center;
        }

        .input-wrapper {
            display: flex;
            gap: 10px;
            max-width: 700px;
            width: 100%;
        }

        .input-field {
            flex: 1;
            background: var(--bg-input);
            border: 1px solid var(--border-medium);
            border-radius: 8px;
            padding: 12px 16px;
            font-family: 'IBM Plex Sans', sans-serif;
            font-size: 14px;
            color: var(--text-primary);
            outline: none;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .input-field:focus {
            border-color: var(--accent-teal);
            box-shadow: 0 0 0 3px rgba(13, 148, 136, 0.15);
        }

        .input-field::placeholder { color: var(--text-secondary); }

        .submit-btn {
            background: linear-gradient(180deg, rgba(20, 140, 115, 0.6) 0%, rgba(12, 95, 80, 0.6) 100%);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 12px 28px;
            font-family: 'IBM Plex Sans', sans-serif;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-primary);
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 2px 0 rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .submit-btn:hover { filter: brightness(1.2); transform: translateY(-1px); }
        .submit-btn:active { transform: translateY(1px); box-shadow: inset 0 1px 3px rgba(0,0,0,0.3); }
        .submit-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

        .clear-btn {
            background: linear-gradient(180deg, rgba(100, 100, 110, 0.5) 0%, rgba(70, 70, 80, 0.5) 100%);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 12px 20px;
            font-family: 'IBM Plex Sans', sans-serif;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.2s;
            margin-left: 8px;
            box-shadow: 0 2px 0 rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .clear-btn:hover { filter: brightness(1.2); transform: translateY(-1px); color: var(--text-primary); }
        .clear-btn:active { transform: translateY(1px); box-shadow: inset 0 1px 3px rgba(0,0,0,0.3); }

        .input-helper {
            margin-top: 12px;
            text-align: center;
            max-width: 700px;
            width: 100%;
        }

        .helper-text {
            font-size: 12px;
            color: var(--text-muted);
            margin-bottom: 10px;
            font-style: italic;
        }

        .quick-examples {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
        }

        .example-chip {
            background: rgba(85, 115, 175, 0.2);
            border: 1px solid rgba(85, 115, 175, 0.3);
            border-radius: 16px;
            padding: 4px 12px;
            font-size: 11px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s;
        }

        .example-chip:hover {
            background: rgba(85, 115, 175, 0.4);
            border-color: rgba(85, 115, 175, 0.6);
            color: var(--text-primary);
            transform: translateY(-1px);
        }

        .research-divider {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 20px 0;
            color: var(--text-muted);
            font-size: 11px;
            letter-spacing: 2px;
        }

        .research-divider::before,
        .research-divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--border-medium), transparent);
        }

        .research-section {
            text-align: center;
            max-width: 700px;
            margin: 0 auto;
        }

        .research-hint {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 12px;
        }

        .research-btn {
            background: linear-gradient(180deg, rgba(200, 145, 70, 0.4) 0%, rgba(170, 120, 50, 0.4) 100%);
            border: 1px solid rgba(200, 145, 70, 0.5);
            border-radius: 8px;
            padding: 12px 24px;
            color: var(--text-primary);
            font-size: 13px;
            font-weight: 600;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .research-btn:hover {
            background: linear-gradient(180deg, rgba(200, 145, 70, 0.6) 0%, rgba(170, 120, 50, 0.6) 100%);
            border-color: rgba(200, 145, 70, 0.8);
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(200, 145, 70, 0.3);
        }

        .results-section {
            display: none;
            flex-direction: column;
            gap: 15px;
            animation: fadeIn 0.4s ease;
            max-width: 700px;
            margin: 0 auto;
            width: 100%;
        }

        .results-section.visible { display: flex; }

        .result-card {
            background: var(--bg-tertiary);
            border-left: 3px solid var(--accent-teal);
            padding: 16px 20px;
            border-radius: 0 8px 8px 0;
        }

        .result-card.track-a { border-color: var(--accent-amber); }
        .result-card.track-b { border-color: var(--accent-purple); }
        .result-card.track-c { border-color: var(--accent-cyan); }

        .result-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 10px;
        }

        .result-track {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 22px;
            font-weight: 700;
        }

        .result-track.track-a { color: var(--accent-amber); }
        .result-track.track-b { color: var(--accent-purple); }
        .result-track.track-c { color: var(--accent-cyan); }

        .result-name {
            font-size: 14px;
            font-weight: 600;
            letter-spacing: 2px;
        }

        .result-name.track-a { color: var(--accent-amber); }
        .result-name.track-b { color: var(--accent-purple); }
        .result-name.track-c { color: var(--accent-cyan); }

        .result-confidence {
            margin-left: auto;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 11px;
            color: var(--text-muted);
        }

        .result-empathy {
            font-size: 15px;
            color: var(--text-primary);
            line-height: 1.7;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-subtle);
            margin-bottom: 10px;
            font-style: italic;
        }

        .result-reasoning {
            font-size: 12px;
            color: var(--text-muted);
            line-height: 1.5;
            opacity: 0.8;
        }

        .clarify-section {
            display: none;
            flex-direction: column;
            gap: 20px;
            padding: 24px;
            background: var(--bg-secondary);
            border: 2px solid var(--accent-blue);
            border-radius: 12px;
        }

        .clarify-section.visible { display: flex; }

        .clarify-question {
            font-size: 16px;
            color: var(--text-primary);
            line-height: 1.6;
            text-align: center;
            font-weight: 500;
        }

        .clarify-options {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .clarify-btn {
            background: var(--bg-input);
            border: 2px solid var(--border-medium);
            border-radius: 8px;
            padding: 20px 24px;
            font-family: 'IBM Plex Sans', sans-serif;
            font-size: 15px;
            line-height: 1.5;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
        }

        .clarify-btn[data-track="A"] { border-color: var(--accent-amber); background: rgba(212, 168, 83, 0.1); }
        .clarify-btn[data-track="A"]:hover { background: rgba(212, 168, 83, 0.2); transform: translateX(4px); }
        .clarify-btn[data-track="B"] { border-color: var(--accent-purple); background: rgba(102, 126, 234, 0.1); }
        .clarify-btn[data-track="B"]:hover { background: rgba(102, 126, 234, 0.2); transform: translateX(4px); }
        .clarify-btn[data-track="C"] { border-color: var(--accent-cyan); background: rgba(96, 165, 250, 0.1); }
        .clarify-btn[data-track="C"]:hover { background: rgba(96, 165, 250, 0.2); transform: translateX(4px); }

        .action-row {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .action-btn {
            background: transparent;
            border: 1px solid var(--border-medium);
            border-radius: 6px;
            padding: 10px 24px;
            font-family: 'IBM Plex Sans', sans-serif;
            font-size: 11px;
            font-weight: 500;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .action-btn.primary { border-color: var(--accent-teal); color: var(--accent-teal); }
        .action-btn.primary:hover { background: var(--accent-teal); color: var(--bg-primary); }
        .action-btn.secondary { color: var(--accent-amber); border-color: var(--accent-amber); font-weight: 600; }
        .action-btn.secondary:hover { background: var(--accent-amber); color: var(--bg-primary); }

        .bottom-bar {
            grid-column: 1 / -1;
            display: flex;
            gap: 3px;
        }

        .bottom-left {
            width: 280px;
            background: linear-gradient(180deg, rgba(30, 58, 95, 0.7) 0%, rgba(15, 23, 42, 0.7) 100%);
            border-radius: 0 0 0 30px;
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-top: none;
        }

        .bottom-middle {
            flex: 1;
            background: linear-gradient(180deg, rgba(118, 75, 162, 0.4) 0%, rgba(88, 56, 121, 0.4) 100%);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 25px;
            border: 1px solid rgba(118, 75, 162, 0.3);
        }

        .bottom-middle span {
            font-size: 10px;
            font-weight: 500;
            color: var(--text-muted);
            letter-spacing: 2px;
        }

        .bottom-right {
            width: 120px;
            background: linear-gradient(180deg, rgba(30, 58, 95, 0.8) 0%, rgba(15, 23, 42, 0.9) 100%);
            border-radius: 0 0 30px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-top: none;
            padding: 4px;
        }

        .bottom-right img {
            height: 36px;
            width: auto;
            border-radius: 4px;
        }

        .test-toggle {
            position: fixed;
            bottom: 60px;
            right: 15px;
            background: linear-gradient(180deg, rgba(200, 145, 70, 0.5) 0%, rgba(150, 105, 45, 0.5) 100%);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 6px;
            padding: 6px 12px;
            font-family: 'IBM Plex Sans', sans-serif;
            font-size: 9px;
            font-weight: 600;
            color: var(--text-primary);
            letter-spacing: 1px;
            cursor: pointer;
            z-index: 100;
        }

        .test-toggle:hover { filter: brightness(1.2); }

        .test-panel {
            position: fixed;
            bottom: 95px;
            right: 15px;
            background: var(--bg-card);
            border: 1px solid var(--border-medium);
            border-radius: 8px;
            padding: 12px;
            max-width: 320px;
            max-height: 300px;
            overflow-y: auto;
            z-index: 99;
            display: none;
        }

        .test-panel.visible { display: block; }

        .test-panel h4 {
            font-size: 10px;
            font-weight: 600;
            color: var(--accent-amber);
            letter-spacing: 1px;
            margin-bottom: 10px;
        }

        .test-item {
            padding: 6px 8px;
            font-size: 11px;
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 4px;
            transition: background 0.2s;
            margin-bottom: 2px;
        }

        .test-item:hover { background: var(--bg-tertiary); }

        .test-item span {
            font-size: 9px;
            font-weight: 600;
            padding: 2px 5px;
            border-radius: 3px;
            margin-left: 6px;
            color: var(--text-primary);
        }

        .test-item span.a { background: rgba(212, 168, 83, 0.5); }
        .test-item span.b { background: rgba(118, 75, 162, 0.5); }
        .test-item span.c { background: rgba(20, 184, 166, 0.5); }
        .test-item span.q { background: rgba(59, 130, 246, 0.5); }

        /* Language Test Mode */
        .lang-test-toggle {
            position: fixed;
            bottom: 60px;
            right: 130px;
            background: linear-gradient(180deg, rgba(102, 126, 234, 0.5) 0%, rgba(72, 96, 204, 0.5) 100%);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 6px;
            padding: 6px 12px;
            font-family: 'IBM Plex Sans', sans-serif;
            font-size: 9px;
            font-weight: 600;
            color: var(--text-primary);
            letter-spacing: 1px;
            cursor: pointer;
            z-index: 100;
        }

        .lang-test-toggle:hover { filter: brightness(1.2); }

        .lang-test-panel {
            position: fixed;
            bottom: 95px;
            right: 130px;
            background: var(--bg-card);
            border: 1px solid var(--accent-purple);
            border-radius: 8px;
            padding: 12px;
            max-width: 380px;
            max-height: 400px;
            overflow-y: auto;
            z-index: 99;
            display: none;
        }

        .lang-test-panel.visible { display: block; }

        .lang-test-panel h4 {
            font-size: 10px;
            font-weight: 600;
            color: var(--accent-purple);
            letter-spacing: 1px;
            margin-bottom: 10px;
        }

        .lang-test-item {
            padding: 8px 10px;
            font-size: 11px;
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 4px;
            transition: background 0.2s;
            margin-bottom: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 3px solid transparent;
        }

        .lang-test-item:hover { 
            background: var(--bg-tertiary); 
            border-left-color: var(--accent-purple);
        }

        .lang-test-item .lang-code {
            font-size: 9px;
            font-weight: 600;
            padding: 2px 6px;
            border-radius: 3px;
            background: rgba(102, 126, 234, 0.3);
            color: var(--text-primary);
            min-width: 28px;
            text-align: center;
        }

        .lang-test-item .lang-claim {
            flex: 1;
            margin-left: 10px;
            font-size: 10px;
            color: var(--text-muted);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .loading-pulse { animation: pulse 1.5s ease-in-out infinite; }

        /* MOBILE RESPONSIVE - FIXED */
        @media (max-width: 1200px) {
            .lcars-container { grid-template-columns: 240px 1fr; }
            .sidebar-label { flex: 1 0 65px; max-width: 90px; font-size: 10px; padding: 0 6px 0 4px; }
            .sidebar-number { width: 46px; flex: 0 0 46px; font-size: 13px; }
            .sidebar-action { width: 70px; font-size: 8px; padding: 0 6px 0 0; }
            .sidebar-buttons { padding: 3px 40px 3px 0; }
        }

        @media (max-width: 992px) {
            .lcars-container { grid-template-columns: 1fr; grid-template-rows: auto auto 1fr auto; }
            .sidebar { display: none; }
            .top-bar { grid-column: 1; }
            .top-bracket-left { width: auto; min-width: 100px; flex: 0 1 150px; border-radius: 0 0 0 20px; }
            .top-bracket-right { width: auto; min-width: 80px; flex: 0 1 100px; border-radius: 0 0 20px 0; }
            .clock-row { padding: 0 10px; }
            .bottom-bar { grid-column: 1; }
            .bottom-left { width: 100px; border-radius: 0 0 0 20px; }
            .bottom-right { width: 80px; border-radius: 0 0 20px 0; }
        }

        @media (max-width: 768px) {
            .top-bracket-left span:last-child, .top-bracket-right span { display: none; }
            .top-bracket-left { min-width: 60px; flex: 0 0 60px; justify-content: center; }
            .top-bracket-right { min-width: 50px; flex: 0 0 50px; }
            .clock-left-bar { display: none; }
            .clock-frame { border-radius: 8px; border-left: 1px solid rgba(59, 130, 246, 0.3); }
            .track-buttons { width: clamp(90px, 25vw, 140px); }
            .content-header h2 { font-size: 14px; }
            .content-header .version { font-size: 9px; }
            .submit-btn { padding: 10px 20px; font-size: 11px; }
            .bottom-left, .bottom-right { display: none; }
            .bottom-middle { border-radius: 0 0 15px 15px; }
            .status-row { flex-wrap: wrap; height: auto; gap: 2px; }
            .status-bar { flex: 1 1 auto; min-width: 100px; height: 20px; font-size: 8px; padding: 0 8px; }
        }

        @media (max-width: 576px) {
            .lcars-container { padding: 5px; gap: 3px; }
            .top-bar { min-height: 35px; }
            .top-bracket-left, .top-bracket-right { display: none; }
            .top-middle { border-radius: 0 0 15px 15px; flex-direction: column; padding: 8px 10px; gap: 5px; }
            .top-middle span { font-size: 11px; letter-spacing: 1px; }
            .language-selector { margin-left: 0 !important; }
            .language-selector select { font-size: 12px; padding: 4px 8px; min-width: 110px; }
            .clock-row { height: auto; padding: 8px 5px; flex-direction: column; align-items: center; gap: 8px; }
            .veracity-logo-row { display: none; }
            .clock-left-group { width: 100%; justify-content: center; }
            .clock-frame { border-radius: 8px; border: 1px solid rgba(59, 130, 246, 0.3); min-width: unset; width: auto; padding: 6px 16px; }
            .clock-time { font-size: 24px; }
            .track-buttons { width: 100%; max-width: 220px; margin: 0 auto; grid-template-columns: 1fr 1fr; gap: 4px; }
            .track-btn { height: 32px; font-size: 9px; letter-spacing: 0.5px; }
            .status-row { display: none; }
            .content-panel { border-radius: 10px; }
            .content-header { padding: 10px 12px; flex-direction: column; gap: 5px; text-align: center; }
            .content-header h2 { font-size: 14px; letter-spacing: 1.5px; }
            .content-body { padding: 15px 12px; }
            .input-label { font-size: 10px; letter-spacing: 1.5px; }
            .input-wrapper { flex-direction: column; gap: 10px; }
            .input-field { font-size: 16px; padding: 12px; }
            .submit-btn, .clear-btn { width: 100%; padding: 12px; margin-left: 0; }
            .input-helper { margin-top: 15px; }
            .helper-text { font-size: 11px; }
            .quick-examples { gap: 6px; }
            .example-chip { font-size: 10px; padding: 6px 10px; }
            .research-divider { margin: 15px 0; font-size: 10px; }
            .research-hint { font-size: 11px; }
            .research-btn { padding: 10px 16px; font-size: 11px; width: 100%; }
            .result-card { padding: 12px; }
            .result-header { flex-wrap: wrap; gap: 8px; }
            .result-track { font-size: 18px; }
            .result-name { font-size: 12px; }
            .result-confidence { width: 100%; margin-left: 0; margin-top: 4px; }
            .clarify-section { padding: 16px; }
            .clarify-question { font-size: 14px; }
            .clarify-btn { width: 100%; padding: 14px 16px; font-size: 13px; }
            .action-row { flex-direction: column; gap: 8px; }
            .action-btn { width: 100%; padding: 12px; }
            .bottom-middle { flex-direction: column; padding: 8px 15px; gap: 3px; text-align: center; }
            .bottom-middle span { font-size: 9px; }
            .test-toggle { bottom: 10px; right: 10px; font-size: 8px; padding: 5px 10px; }
            .test-panel { bottom: 45px; right: 10px; left: 10px; max-width: none; }
            .factoid-display { padding: 12px; }
            .factoid-category { font-size: 8px; }
            .factoid-text { font-size: 12px; }
        }

        @media (max-width: 380px) {
            .clock-time { font-size: 20px; }
            .clock-subtext span { font-size: 7px; }
            .track-buttons { max-width: 180px; }
            .track-btn { height: 28px; font-size: 8px; }
            .content-header h2 { font-size: 12px; letter-spacing: 1px; }
            .example-chip { font-size: 9px; padding: 5px 8px; }
            .top-middle span { font-size: 9px; }
        }

        /* ==================== HAMBURGER MENU & MOBILE SIDEBAR ==================== */
        .hamburger-btn {
            display: none;
            position: absolute;
            top: 8px;
            left: 8px;
            z-index: 50;
            width: 36px;
            height: 36px;
            background: linear-gradient(180deg, rgba(59, 130, 246, 0.6) 0%, rgba(37, 99, 235, 0.6) 100%);
            border: 1px solid rgba(96, 165, 250, 0.4);
            border-radius: 8px;
            cursor: pointer;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
            transition: all 0.3s ease;
        }

        .hamburger-btn:hover {
            background: linear-gradient(180deg, rgba(96, 165, 250, 0.8) 0%, rgba(59, 130, 246, 0.8) 100%);
            transform: scale(1.05);
        }

        .hamburger-btn span {
            display: block;
            width: 18px;
            height: 2px;
            background: var(--text-primary);
            border-radius: 2px;
            transition: all 0.3s ease;
        }

        .hamburger-btn.active span:nth-child(1) {
            transform: rotate(45deg) translate(4px, 4px);
        }

        .hamburger-btn.active span:nth-child(2) {
            opacity: 0;
            transform: translateX(-10px);
        }

        .hamburger-btn.active span:nth-child(3) {
            transform: rotate(-45deg) translate(4px, -4px);
        }

        /* Mobile sidebar overlay */
        .mobile-sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(10, 10, 18, 0.85);
            backdrop-filter: blur(8px);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .mobile-sidebar-overlay.visible {
            opacity: 1;
        }

        /* Mobile sidebar container */
        .mobile-sidebar {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 300px;
            max-width: 85vw;
            height: 100vh;
            background: linear-gradient(180deg, var(--bg-secondary) 0%, var(--bg-primary) 100%);
            border-right: 2px solid rgba(59, 130, 246, 0.4);
            z-index: 1050;
            transform: translateX(-100%);
            transition: transform 0.35s cubic-bezier(0.4, 0, 0.2, 1);
            overflow-y: auto;
            padding: 70px 15px 20px 15px;
            box-shadow: 5px 0 30px rgba(0, 0, 0, 0.5);
        }

        .mobile-sidebar.visible {
            transform: translateX(0);
        }

        .mobile-sidebar-header {
            text-align: center;
            padding-bottom: 15px;
            margin-bottom: 15px;
            border-bottom: 1px solid rgba(59, 130, 246, 0.3);
        }

        .mobile-sidebar-header h3 {
            font-size: 14px;
            font-weight: 600;
            color: var(--accent-amber);
            letter-spacing: 3px;
            margin-bottom: 5px;
        }

        .mobile-sidebar-header span {
            font-size: 10px;
            color: var(--text-muted);
            letter-spacing: 1px;
        }

        .mobile-sidebar-section {
            margin-bottom: 20px;
        }

        .mobile-sidebar-section-title {
            font-size: 9px;
            font-weight: 600;
            color: var(--text-muted);
            letter-spacing: 2px;
            margin-bottom: 10px;
            padding-left: 5px;
        }

        .mobile-sidebar-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 15px;
            margin-bottom: 4px;
            background: rgba(30, 58, 95, 0.4);
            border-radius: 8px;
            border-left: 3px solid transparent;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .mobile-sidebar-item:hover {
            background: rgba(30, 58, 95, 0.7);
            transform: translateX(4px);
        }

        .mobile-sidebar-item.history { border-left-color: rgba(212, 168, 83, 0.8); }
        .mobile-sidebar-item.science { border-left-color: rgba(13, 148, 136, 0.8); }
        .mobile-sidebar-item.philosophy { border-left-color: rgba(102, 126, 234, 0.8); }
        .mobile-sidebar-item.logic { border-left-color: rgba(59, 130, 246, 0.8); }
        .mobile-sidebar-item.rhetoric { border-left-color: rgba(118, 75, 162, 0.8); }
        .mobile-sidebar-item.media { border-left-color: rgba(33, 150, 243, 0.8); }
        .mobile-sidebar-item.psychology { border-left-color: rgba(20, 184, 166, 0.8); }
        .mobile-sidebar-item.statistics { border-left-color: rgba(96, 165, 250, 0.8); }
        .mobile-sidebar-item.sources { border-left-color: rgba(212, 168, 83, 0.8); }
        .mobile-sidebar-item.export { border-left-color: rgba(100, 116, 139, 0.8); }

        .mobile-sidebar-item .item-icon {
            font-size: 16px;
            width: 24px;
            text-align: center;
        }

        .mobile-sidebar-item .item-label {
            flex: 1;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-primary);
            letter-spacing: 1px;
        }

        .mobile-sidebar-item .item-value {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 11px;
            color: var(--accent-amber);
            background: var(--bg-input);
            padding: 3px 8px;
            border-radius: 4px;
            border: 1px solid var(--border-medium);
        }

        /* Show hamburger and mobile sidebar on tablet/mobile */
        @media (max-width: 992px) {
            .hamburger-btn {
                display: flex;
            }
            .mobile-sidebar-overlay,
            .mobile-sidebar {
                display: block;
            }
            .content-header {
                padding-left: 50px;
            }
        }

        /* ==================== TEST BUTTONS & AUDIO TOGGLE MOBILE FIX ==================== */
        /* Mobile audio toggle */
        .mobile-audio-toggle {
            display: none;
            width: 22px;
            height: 22px;
            background-image: url('/images/speaker-grill.webp');
            background-size: cover;
            background-position: center;
            border-radius: 4px;
            border: 1px solid rgba(96, 165, 250, 0.4);
            cursor: pointer;
            transition: all 0.3s ease;
            opacity: 0.6;
            flex-shrink: 0;
        }
        
        .mobile-audio-toggle:hover {
            opacity: 0.9;
            box-shadow: inset 0 0 20px rgba(96, 165, 250, 0.5);
        }
        
        .mobile-audio-toggle.playing {
            opacity: 1;
            box-shadow: 
                inset 0 0 20px rgba(96, 165, 250, 0.6),
                0 0 15px rgba(96, 165, 250, 0.4);
            animation: speaker-glow 2s ease-in-out infinite;
        }
        
        /* Mobile controls wrapper - sits in bottom-middle on right side, stacked vertically */
        .mobile-bottom-controls {
            display: none;
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            flex-direction: column;
            align-items: stretch;
            gap: 2px;
            z-index: 50;
            width: 42px;
        }
        
        .mobile-bottom-controls .test-toggle,
        .mobile-bottom-controls .lang-test-toggle {
            position: static !important;
            font-size: 5px;
            padding: 2px 4px;
            line-height: 1.1;
            height: auto;
            white-space: nowrap;
            width: 100%;
            text-align: center;
            box-sizing: border-box;
        }
        
        .mobile-bottom-controls .mobile-audio-toggle {
            width: 100%;
            height: 12px;
        }

        @media (max-width: 768px) {
            /* Hide the original fixed-position buttons */
            body > .test-toggle,
            body > .lang-test-toggle {
                display: none !important;
            }
            
            /* Show the mobile controls in bottom bar */
            .mobile-bottom-controls {
                display: flex;
            }
            
            .mobile-audio-toggle {
                display: block;
            }
            
            /* Make bottom-middle position relative for absolute children */
            .bottom-middle {
                position: relative;
            }
            
            .test-panel {
                position: fixed;
                bottom: 55px;
                right: 10px;
                left: 10px;
                max-width: none;
            }
            
            .lang-test-panel {
                position: fixed;
                bottom: 55px;
                right: 10px;
                left: 10px;
                max-width: none;
            }
        }

        @media (max-width: 576px) {
            .hamburger-btn {
                top: 6px;
                left: 6px;
                width: 32px;
                height: 32px;
            }
            
            .hamburger-btn span {
                width: 16px;
            }
            
            .content-header {
                padding-left: 45px;
            }
            
            .mobile-sidebar {
                width: 280px;
                padding: 60px 12px 15px 12px;
            }
            
            .mobile-sidebar-item {
                padding: 10px 12px;
            }
            
            .mobile-sidebar-item .item-label {
                font-size: 11px;
            }
            
            .mobile-bottom-controls {
                gap: 3px;
            }
            
            .mobile-bottom-controls .test-toggle,
            .mobile-bottom-controls .lang-test-toggle {
                font-size: 5px;
                padding: 2px 4px;
            }
            
            .mobile-audio-toggle {
                width: 24px;
                height: 24px;
            }
            
            .test-panel,
            .lang-test-panel {
                bottom: 50px;
            }
        } {
                font-size: 11px;
            }
            
            .mobile-controls-stack {
                bottom: 6px;
                right: 6px;
                gap: 5px;
            }
            
            .mobile-controls-stack .test-toggle,
            .mobile-controls-stack .lang-test-toggle {
                width: 32px;
                height: 32px;
                font-size: 5px;
            }
            
            .mobile-audio-toggle {
                width: 32px;
                height: 32px;
            }
            
            .test-panel {
                bottom: 44px;
                max-width: 260px;
            }
            
            .lang-test-panel {
                bottom: 82px;
                max-width: 260px;
            }
        }
    </style>
</head>
<body>
    <!-- Mobile Sidebar Overlay -->
    <div class="mobile-sidebar-overlay" id="mobileSidebarOverlay"></div>
    <div class="mobile-sidebar" id="mobileSidebar">
        <div class="mobile-sidebar-header">
            <h3>VERITAS</h3>
            <span>ANALYSIS DISCIPLINES</span>
        </div>
        
        <div class="mobile-sidebar-section">
            <div class="mobile-sidebar-section-title">DISCIPLINES</div>
            <div class="mobile-sidebar-item history" data-factoid="history">
                <span class="item-icon">📜</span>
                <span class="item-label" data-i18n="history">HISTORY</span>
                <span class="item-value">147</span>
            </div>
            <div class="mobile-sidebar-item science" data-factoid="science">
                <span class="item-icon">🔬</span>
                <span class="item-label" data-i18n="science">SCIENCE</span>
                <span class="item-value">523</span>
            </div>
            <div class="mobile-sidebar-item philosophy" data-factoid="philosophy">
                <span class="item-icon">🎭</span>
                <span class="item-label" data-i18n="philosophy">PHILOSOPHY</span>
                <span class="item-value">312</span>
            </div>
            <div class="mobile-sidebar-item logic" data-factoid="logic">
                <span class="item-icon">🧩</span>
                <span class="item-label" data-i18n="logic">LOGIC</span>
                <span class="item-value">089</span>
            </div>
            <div class="mobile-sidebar-item rhetoric" data-factoid="rhetoric">
                <span class="item-icon">🗣️</span>
                <span class="item-label" data-i18n="rhetoric">RHETORIC</span>
                <span class="item-value">276</span>
            </div>
            <div class="mobile-sidebar-item media" data-factoid="media">
                <span class="item-icon">📺</span>
                <span class="item-label" data-i18n="media">MEDIA</span>
                <span class="item-value">418</span>
            </div>
            <div class="mobile-sidebar-item psychology" data-factoid="psych">
                <span class="item-icon">🧠</span>
                <span class="item-label" data-i18n="psychology">PSYCHOLOGY</span>
                <span class="item-value">067</span>
            </div>
            <div class="mobile-sidebar-item statistics" data-factoid="stats">
                <span class="item-icon">📊</span>
                <span class="item-label" data-i18n="statistics">STATISTICS</span>
                <span class="item-value">234</span>
            </div>
        </div>
        
        <div class="mobile-sidebar-section">
            <div class="mobile-sidebar-section-title">TOOLS</div>
            <div class="mobile-sidebar-item sources">
                <span class="item-icon">📚</span>
                <span class="item-label" data-i18n="sources">SOURCES</span>
                <span class="item-value">089</span>
            </div>
            <div class="mobile-sidebar-item export" id="mobileExportBtn">
                <span class="item-icon">💾</span>
                <span class="item-label" data-i18n="export">EXPORT</span>
                <span class="item-value" id="mobileExportCount">000</span>
            </div>
        </div>
    </div>
    
    <div class="lcars-container">
        <div class="top-bar">
            <div class="top-bracket-left" id="btnHome" onclick="window.location.href='https://veritastruth.net'" style="cursor: pointer;" title="Return to VERITAS Home">
                <span data-i18n="home">🏠 HOME</span>
                <span data-i18n="settings">SETTINGS</span>
            </div>
            <div class="top-middle">
                <span id="mainTitle">VERITAS - Truth Through Transparency</span>
                <div class="language-selector" style="margin-left: 20px;">
                    <select id="languageSelect" title="Universal Translator - Select Your Language">
                        <option value="en">🌐 English</option>
                        <option value="es">🇪🇸 Español</option>
                        <option value="fr">🇫🇷 Français</option>
                        <option value="de">🇩🇪 Deutsch</option>
                        <option value="it">🇮🇹 Italiano</option>
                        <option value="pt">🇧🇷 Português</option>
                        <option value="ru">🇷🇺 Русский</option>
                        <option value="uk">🇺🇦 Українська</option>
                        <option value="el">🇬🇷 Ελληνικά</option>
                        <option value="ar">🇸🇦 العربية</option>
                        <option value="he">🇮🇱 עברית</option>
                        <option value="zh">🇨🇳 中文</option>
                        <option value="ja">🇯🇵 日本語</option>
                        <option value="ko">🇰🇷 한국어</option>
                    </select>
                </div>
            </div>
            <div class="top-bracket-right" onclick="location.reload()" style="cursor: pointer;" title="Refresh Interface">
                <span id="refreshLabel" data-i18n="refresh">REFRESH</span>
            </div>
        </div>
        
        <!-- Warp Core Pulse - Top Bar continuation -->
        <div id="warpPulseTopbar" class="warp-pulse-topbar"></div>

        <div class="sidebar">
            <div class="sidebar-top-curve"></div>
            <div class="sidebar-spine"></div>
            
            <!-- Warp Core Pulse Container -->
            <div id="warpPulseContainer" class="warp-pulse-container">
                <div class="warp-pulse-bottom"></div>
                <div class="warp-pulse-spine"></div>
                <div class="warp-pulse-top-curve"></div>
            </div>
            
            <div class="sidebar-buttons">
                <div class="sidebar-row">
                    <div class="sidebar-label history" data-factoid="history" data-i18n="history">HISTORY</div>
                    <div class="sidebar-number" title="Knowledge Sources: Historical texts, archives, and documented events available for analysis">247</div>
                    <div class="sidebar-action archives" data-action="archives" data-i18n="archives" title="ACCESS HISTORICAL ARCHIVES: Browse documented events, primary sources, and historical context">ARCHIVES</div>
                </div>
                <div class="sidebar-row">
                    <div class="sidebar-label science" data-factoid="science" data-i18n="sciences">SCIENCES</div>
                    <div class="sidebar-number" title="Knowledge Sources: Scientific studies, peer-reviewed papers, and empirical research available">182</div>
                    <div class="sidebar-action research" data-action="research" data-i18n="research" title="SCIENTIFIC RESEARCH: Access peer-reviewed studies, experimental data, and scientific consensus">RESEARCH</div>
                </div>
                <div class="sidebar-row">
                    <div class="sidebar-label philosophy" data-factoid="philosophy" data-i18n="philosophy">PHILOSOPHY</div>
                    <div class="sidebar-number" title="Knowledge Sources: Philosophical traditions, ethical frameworks, and wisdom teachings">093</div>
                    <div class="sidebar-action ethics" data-action="ethics" data-i18n="ethics" title="ETHICAL ANALYSIS: Explore moral frameworks, value systems, and philosophical perspectives">ETHICS</div>
                </div>
                <div class="sidebar-row">
                    <div class="sidebar-label logic" data-factoid="logic" data-i18n="logic">LOGIC</div>
                    <div class="sidebar-number" title="Knowledge Sources: Logical principles, reasoning patterns, and critical thinking frameworks">156</div>
                    <div class="sidebar-action fallacies" data-action="fallacies" data-i18n="fallacies" title="LOGICAL FALLACIES: Identify flawed reasoning, invalid arguments, and cognitive errors">FALLACIES</div>
                </div>
                <div class="sidebar-divider"></div>
                <div class="sidebar-row">
                    <div class="sidebar-label rhetoric" data-factoid="rhetoric" data-i18n="rhetoric">RHETORIC</div>
                    <div class="sidebar-number" title="Knowledge Sources: Rhetorical devices, persuasive techniques, and communication patterns">078</div>
                    <div class="sidebar-action persuasion" data-action="persuasion" data-i18n="persuasion" title="PERSUASION TECHNIQUES: Analyze rhetorical strategies, influence tactics, and communication methods">PERSUASION</div>
                </div>
                <div class="sidebar-row">
                    <div class="sidebar-label media" data-factoid="media" data-i18n="media">MEDIA</div>
                    <div class="sidebar-number" title="Knowledge Sources: Media analysis techniques, literacy frameworks, and information evaluation">412</div>
                    <div class="sidebar-action literacy" data-action="literacy" data-i18n="literacy" title="MEDIA LITERACY: Evaluate information sources, detect manipulation, and assess credibility">LITERACY</div>
                </div>
                <div class="sidebar-row">
                    <div class="sidebar-label psychology" data-factoid="psych" data-i18n="psychology">PSYCHOLOGY</div>
                    <div class="sidebar-number" title="Knowledge Sources: Cognitive biases, behavioral patterns, and psychological research">067</div>
                    <div class="sidebar-action bias" data-action="bias" data-i18n="bias" title="COGNITIVE BIAS: Detect systematic thinking errors, mental shortcuts, and judgment distortions">BIAS</div>
                </div>
                <div class="sidebar-row">
                    <div class="sidebar-label statistics" data-factoid="stats" data-i18n="statistics">STATISTICS</div>
                    <div class="sidebar-number" title="Knowledge Sources: Statistical methods, data analysis techniques, and quantitative research">234</div>
                    <div class="sidebar-action data" data-action="data" data-i18n="data" title="DATA ANALYSIS: Examine statistical claims, interpret quantitative evidence, and validate findings">DATA</div>
                </div>
                <div class="sidebar-divider"></div>
                <div class="sidebar-row">
                    <div class="sidebar-label sources" data-i18n="sources">SOURCES</div>
                    <div class="sidebar-number" title="Knowledge Sources: Source evaluation criteria, citation databases, and verification tools">089</div>
                    <div class="sidebar-action verify" data-action="verify" data-i18n="verify" title="SOURCE VERIFICATION: Cross-reference claims, check citations, and validate authenticity">VERIFY</div>
                </div>
                <div class="sidebar-row">
                    <div class="sidebar-label export" id="btnExport" data-i18n="export">EXPORT</div>
                    <div class="sidebar-number" id="exportCount" title="Reports Generated: Number of analyses exported for external use">000</div>
                    <div class="sidebar-action reports" id="btnReports" data-i18n="reports" title="GENERATE REPORTS: Create comprehensive analysis documents for sharing and archival">REPORTS</div>
                </div>
            </div>
            <div class="sidebar-bottom-curve"></div>
            <div class="sidebar-elbow"></div>
        </div>

        <div class="main-area">
            <div class="clock-row">
                <div class="clock-left-group">
                    <div class="clock-left-bar">
                        <div class="clock-left-btn" data-i18n="lcarsLock">LCARS LOCK</div>
                        <div class="clock-left-btn teal" data-i18n="timerMode">TIMER MODE</div>
                    </div>
                    <div class="clock-frame">
                        <div class="clock-time" id="clockDisplay">00:00:00</div>
                        <div class="clock-subtext">
                            <span data-i18n="veracityEngine">VERITAS - Veracity Engine</span>
                            <span id="dateDisplay">STARDATE 2512.29</span>
                        </div>
                    </div>
                </div>
                <div class="veracity-logo-row">
                    <img src="Veracity_Logo.png" alt="Veracity" class="veracity-logo-img">
                </div>
                <div class="track-buttons">
                    <div class="track-btn track-a" id="btnTrackA" data-i18n="trackAssess">ASSESS</div>
                    <div class="track-btn track-b" id="btnTrackB" data-i18n="trackConversation">INTERVIEW</div>
                    <div class="track-btn track-c" id="btnTrackC" data-i18n="trackNavigate">NAVIGATE</div>
                    <div class="track-btn working" id="btnWorking" data-i18n="loading">WORKING</div>
                </div>
            </div>

            <div class="status-row">
                <div class="status-bar teal" data-i18n="statusIntake">INTAKE LAYER ACTIVE</div>
                <div class="status-bar purple" data-i18n="statusClassification">CLASSIFICATION ENGINE READY</div>
                <div class="status-bar right" id="statusBar" data-i18n="statusAwaiting">AWAITING INPUT</div>
            </div>

            <div class="content-panel">
                <div class="content-header">
                    <!-- Mobile Hamburger Menu -->
                    <button class="hamburger-btn" id="hamburgerBtn" aria-label="Open navigation menu">
                        <span></span>
                        <span></span>
                        <span></span>
                    </button>
                    <h2 id="searchTitle" data-i18n="searchTitle">VERACITY™ SEARCH</h2>
                    <span class="version" id="companyName" data-i18n="companyName">VERITAS LLC</span>
                </div>
                <div class="content-body">
                    <div class="factoid-display" id="factoidDisplay">
                        <div class="factoid-category" id="factoidCategory">CATEGORY</div>
                        <div class="factoid-text" id="factoidText">Factoid content here...</div>
                        <div class="factoid-close" id="factoidDismiss" data-i18n="dismiss" onclick="hideFactoid()">[ DISMISS ]</div>
                    </div>

                    <div class="input-section" id="inputSection">
                        <div class="input-label" id="inputLabel" data-i18n="inputLabel">WHAT WOULD YOU LIKE TO EXPLORE?</div>
                        <div class="input-wrapper">
                            <input type="text" class="input-field" id="userInput" placeholder="Enter a claim, question, belief, or situation..." data-i18n-placeholder="placeholder">
                            <button class="submit-btn" id="submitBtn" data-i18n="analyze">ANALYZE</button>
                            <button class="clear-btn" id="clearBtn" data-i18n="clear">CLEAR</button>
                        </div>
                        <div class="input-helper">
                            <div class="helper-text" id="helperText" data-i18n="helperText">Try one of these examples to see how Veracity works:</div>
                            <div class="quick-examples">
                                <span class="example-chip" id="chip1" data-i18n="chip1" data-input="Do politicians actually keep their campaign promises?">campaign promises</span>
                                <span class="example-chip" id="chip2" data-i18n="chip2" data-input="Is mainstream media biased against conservatives?">media bias</span>
                                <span class="example-chip" id="chip3" data-i18n="chip3" data-input="How do I evaluate statistics in news articles?">evaluating statistics</span>
                                <span class="example-chip" id="chip4" data-i18n="chip4" data-input="Are corporations doing enough about climate change?">corporate climate action</span>
                            </div>
                        </div>
                        <div class="research-divider" id="researchDivider" data-i18n="researchDivider">OR</div>
                        <div class="research-section">
                            <div class="research-hint" id="researchHint" data-i18n="researchHint">Have a news article, social media post, or URL you want to fact-check?</div>
                            <button class="research-btn" id="researchBtn">
                                <span class="icon">🔍</span>
                                <span data-i18n="researchBtn">RESEARCH AN ARTICLE OR POST</span>
                            </button>
                        </div>
                    </div>

                    <div class="results-section" id="resultsSection">
                        <div class="result-card" id="resultCard">
                            <div class="result-header">
                                <span class="result-track" id="resultTrack">A</span>
                                <span class="result-name" id="resultName">ASSESS</span>
                                <span class="result-confidence" id="resultConfidence">92% CONFIDENCE</span>
                            </div>
                            <div class="result-empathy" id="resultEmpathy">This sounds like a factual claim that can be verified.</div>
                            <div class="result-reasoning" id="resultReasoning">Classification reasoning will appear here...</div>
                        </div>
                        <div class="clarify-section" id="clarifySection">
                            <div class="clarify-question" id="clarifyQuestion">Before I can help, I need to understand your intent better...</div>
                            <div class="clarify-options" id="clarifyOptions">
                                <button class="clarify-btn" data-track="A" data-i18n="verClarifyFactCheck">I want to verify facts</button>
                                <button class="clarify-btn" data-track="B" data-i18n="verClarifyExplore">I want to explore my thinking</button>
                                <button class="clarify-btn" data-track="C" data-i18n="verClarifyGuidance">I need practical guidance</button>
                            </div>
                        </div>
                        <div class="action-row" id="actionRow">
                            <button class="action-btn primary" id="continueBtn" data-i18n="verContinue">CONTINUE</button>
                            <button class="action-btn secondary" id="notQuiteBtn" data-i18n="verReframe" title="Click here if none of these options capture what you're looking for">REFRAME MY QUESTION</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="bottom-bar">
            <div class="bottom-left"></div>
            <div class="bottom-middle">
                <span data-i18n="footerMotto">SEEK · QUESTION · UNDERSTAND</span>
                <img src="veritas-logo-horizontal.png" alt="VERITAS LLC" class="bottom-logo" title="VERITAS LLC">
                <span id="weatherDisplay">MADISON, WI — 28°F — HI: 32° LO: 22°</span>
                <!-- Mobile controls - visible only on mobile, sits in bottom bar -->
                <div class="mobile-bottom-controls">
                    <button class="lang-test-toggle" id="mobileLangTestToggle">🌐 LANG</button>
                    <button class="test-toggle" id="mobileTestToggle">TEST</button>
                    <div class="mobile-audio-toggle" id="mobileAudioToggle" title="Engage Warp Core"></div>
                </div>
            </div>
            <div class="bottom-right">
                <div id="audioToggle" class="audio-toggle-corner" onclick="toggleBridgeAudio()" title="Engage Warp Core"></div>
            </div>
        </div>
    </div>

    <button class="test-toggle" id="testToggle">TEST HARNESS</button>
    
    <div id="passwordModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:10000; justify-content:center; align-items:center;">
        <div style="background:var(--bg-secondary); padding:30px; border-radius:12px; border:2px solid var(--accent-amber); text-align:center; max-width:300px;">
            <h3 style="color:var(--accent-amber); margin-bottom:15px;">🔐 Test Harness Access</h3>
            <input type="password" id="testPassword" placeholder="Enter access code" style="width:100%; padding:10px; margin-bottom:15px; background:var(--bg-tertiary); border:1px solid var(--border-subtle); border-radius:6px; color:var(--text-primary); font-size:16px;">
            <div style="display:flex; gap:10px; justify-content:center;">
                <button id="passwordSubmit" style="padding:10px 20px; background:var(--accent-amber); color:black; border:none; border-radius:6px; cursor:pointer; font-weight:bold;">ENTER</button>
                <button id="passwordCancel" style="padding:10px 20px; background:var(--bg-tertiary); color:var(--text-primary); border:1px solid var(--border-subtle); border-radius:6px; cursor:pointer;">CANCEL</button>
            </div>
            <p id="passwordError" style="color:#ff6b6b; margin-top:10px; display:none; font-size:12px;">Invalid code. Try again.</p>
        </div>
    </div>
    
    <div class="test-panel" id="testPanel">
        <h4>TEST HARNESS v1.0</h4>
        <div style="max-height:70vh; overflow-y:auto; padding-right:10px;">
            <h5 style="color:var(--accent-amber); margin:15px 0 8px 0; font-size:12px;">A: Economic Stress</h5>
            <div class="test-item" data-input="My landlord says I gotta be out by Friday but I paid rent">Landlord says out by Friday...</div>
            <div class="test-item" data-input="Payday loan place told me 15% but now they want $800 on a $300 loan">Payday loan $800 on $300...</div>
            <h5 style="color:var(--accent-amber); margin:15px 0 8px 0; font-size:12px;">B: Educational Variation</h5>
            <div class="test-item" data-input="The doctors keep using words I don't understand">Doctors use words I don't understand...</div>
            <div class="test-item" data-input="I read the study myself and it doesn't say what the news says">Read the study myself...</div>
            <h5 style="color:var(--accent-amber); margin:15px 0 8px 0; font-size:12px;">C: Trust Gaps</h5>
            <div class="test-item" data-input="Why should I trust the CDC when Tuskegee happened">Why trust CDC when Tuskegee...</div>
            <div class="test-item" data-input="Police report says one thing but everybody saw different">Police report says one thing...</div>
        </div>
    </div>

    <button class="lang-test-toggle" id="langTestToggle">🌐 LANG TEST</button>
    
    <div id="langPasswordModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:10000; justify-content:center; align-items:center;">
        <div style="background:var(--bg-secondary); padding:30px; border-radius:12px; border:2px solid var(--accent-purple); text-align:center; max-width:300px;">
            <h3 style="color:var(--accent-purple); margin-bottom:15px;">🌐 Language Test Access</h3>
            <input type="password" id="langTestPassword" placeholder="Enter access code" style="width:100%; padding:10px; margin-bottom:15px; background:var(--bg-tertiary); border:1px solid var(--border-subtle); border-radius:6px; color:var(--text-primary); font-size:16px;">
            <div style="display:flex; gap:10px; justify-content:center;">
                <button id="langPasswordSubmit" style="padding:10px 20px; background:var(--accent-purple); color:white; border:none; border-radius:6px; cursor:pointer; font-weight:bold;">ENTER</button>
                <button id="langPasswordCancel" style="padding:10px 20px; background:var(--bg-tertiary); color:var(--text-primary); border:1px solid var(--border-subtle); border-radius:6px; cursor:pointer;">CANCEL</button>
            </div>
            <p id="langPasswordError" style="color:#ff6b6b; margin-top:10px; display:none; font-size:12px;">Invalid code. Try again.</p>
        </div>
    </div>
    
    <div class="lang-test-panel" id="langTestPanel">
        <h4>🌐 VINCULUM LANGUAGE TEST v1.0</h4>
        <p style="font-size:9px; color:var(--text-muted); margin-bottom:12px;">Click a language to test with a culturally-relevant claim. Check results with Microsoft Translate.</p>
        <div style="max-height:320px; overflow-y:auto; padding-right:8px;">
            <div class="lang-test-item" data-lang="en" data-claim="The moon landing was faked by NASA in 1969">
                <span class="lang-code">EN</span>
                <span>English</span>
                <span class="lang-claim">Moon landing conspiracy</span>
            </div>
            <div class="lang-test-item" data-lang="es" data-claim="La siesta es una pérdida de tiempo y reduce la productividad económica">
                <span class="lang-code">ES</span>
                <span>Spanish</span>
                <span class="lang-claim">Siesta y productividad</span>
            </div>
            <div class="lang-test-item" data-lang="fr" data-claim="Le vin français est objectivement supérieur à tous les autres vins du monde">
                <span class="lang-code">FR</span>
                <span>French</span>
                <span class="lang-claim">Supériorité du vin français</span>
            </div>
            <div class="lang-test-item" data-lang="de" data-claim="Deutsche Ingenieurskunst ist anderen Ländern technisch immer überlegen">
                <span class="lang-code">DE</span>
                <span>German</span>
                <span class="lang-claim">Deutsche Ingenieurskunst</span>
            </div>
            <div class="lang-test-item" data-lang="it" data-claim="La dieta mediterranea italiana è la più sana del mondo secondo tutti gli scienziati">
                <span class="lang-code">IT</span>
                <span>Italian</span>
                <span class="lang-claim">Dieta mediterranea</span>
            </div>
            <div class="lang-test-item" data-lang="pt" data-claim="O fado português expressa a verdadeira alma lusitana que outros povos não conseguem entender">
                <span class="lang-code">PT</span>
                <span>Portuguese</span>
                <span class="lang-claim">Alma do fado</span>
            </div>
            <div class="lang-test-item" data-lang="ru" data-claim="Советская наука была более передовой чем западная во всех областях">
                <span class="lang-code">RU</span>
                <span>Russian</span>
                <span class="lang-claim">Советская наука</span>
            </div>
            <div class="lang-test-item" data-lang="uk" data-claim="Українська мова є однією з найдавніших мов у світі">
                <span class="lang-code">UK</span>
                <span>Ukrainian</span>
                <span class="lang-claim">Давність української мови</span>
            </div>
            <div class="lang-test-item" data-lang="el" data-claim="Η αρχαία ελληνική φιλοσοφία είναι η βάση όλης της δυτικής σκέψης">
                <span class="lang-code">EL</span>
                <span>Greek</span>
                <span class="lang-claim">Ελληνική φιλοσοφία</span>
            </div>
            <div class="lang-test-item" data-lang="zh" data-claim="中医比西医更能治疗慢性疾病">
                <span class="lang-code">ZH</span>
                <span>Chinese</span>
                <span class="lang-claim">中医与西医</span>
            </div>
            <div class="lang-test-item" data-lang="ja" data-claim="日本の職人技術は世界で最も優れている">
                <span class="lang-code">JA</span>
                <span>Japanese</span>
                <span class="lang-claim">日本の職人技術</span>
            </div>
            <div class="lang-test-item" data-lang="ko" data-claim="한글은 세계에서 가장 과학적인 문자 체계이다">
                <span class="lang-code">KO</span>
                <span>Korean</span>
                <span class="lang-claim">한글의 과학성</span>
            </div>
            <div class="lang-test-item" data-lang="ar" data-claim="العلماء المسلمون اخترعوا كل أسس العلم الحديث">
                <span class="lang-code">AR</span>
                <span>Arabic</span>
                <span class="lang-claim">العلم الإسلامي</span>
            </div>
            <div class="lang-test-item" data-lang="he" data-claim="התלמוד מכיל את כל החוכמה הנחוצה להבנת העולם המודרני">
                <span class="lang-code">HE</span>
                <span>Hebrew</span>
                <span class="lang-claim">חוכמת התלמוד</span>
            </div>
        </div>
    </div>

    <script src="modules/veritas-translations.js"></script>
    <script src="modules/classifier.js"></script>
    <script src="modules/factoids.js"></script>
    <script src="modules/microdiscovery.js"></script>
    <script src="modules/action-factoids.js"></script>
    <script src="modules/contextual.js"></script>
    <script src="modules/animations.js"></script>
    <script src="modules/export.js"></script>
    <script src="modules/vinculum.js"></script>
    <script>
        // Clock
        function updateClock() {
            const now = new Date();
            document.getElementById('clockDisplay').textContent = 
                String(now.getHours()).padStart(2,'0') + ':' + 
                String(now.getMinutes()).padStart(2,'0') + ':' + 
                String(now.getSeconds()).padStart(2,'0');
            const year = String(now.getFullYear()).slice(-2);
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            document.getElementById('dateDisplay').textContent = `STARDATE ${year}${month}.${day}`;
        }
        setInterval(updateClock, 1000);
        updateClock();

        // Factoids
        function showFactoid(discipline) {
            const disciplineMap = {
                'history': 'history', 'science': 'sciences', 'sciences': 'sciences',
                'philosophy': 'philosophy', 'logic': 'logic', 'rhetoric': 'rhetoric',
                'media': 'media', 'psych': 'psychology', 'psychology': 'psychology',
                'stats': 'statistics', 'statistics': 'statistics', 'sources': 'sources'
            };
            const mapped = disciplineMap[discipline] || discipline;
            if (typeof VeracityFactoids !== 'undefined') {
                const factoid = VeracityFactoids.sync.getRandomFactoid(mapped);
                if (factoid) {
                    const labels = {
                        'history': 'HISTORICAL INSIGHT', 'sciences': 'SCIENTIFIC METHOD',
                        'philosophy': 'PHILOSOPHICAL FOUNDATIONS', 'logic': 'LOGICAL FRAMEWORK',
                        'rhetoric': 'RHETORICAL AWARENESS', 'media': 'MEDIA LITERACY',
                        'psychology': 'COGNITIVE INSIGHT', 'statistics': 'STATISTICAL LITERACY',
                        'sources': 'SOURCE EVALUATION'
                    };
                    document.getElementById('factoidCategory').textContent = labels[mapped] || mapped.toUpperCase();
                    document.getElementById('factoidText').textContent = factoid.text;
                    document.getElementById('factoidDisplay').classList.add('visible');
                }
            }
        }

        function hideFactoid() {
            document.getElementById('factoidDisplay').classList.remove('visible');
        }

        document.querySelectorAll('.sidebar-label[data-factoid]').forEach(btn => {
            btn.addEventListener('click', () => showFactoid(btn.dataset.factoid));
        });

        // ==================== ACTION FACTOIDS (Right Column) ====================
        // Maps action buttons to their category labels
        const actionLabels = {
            'archives': 'ARCHIVAL RESEARCH',
            'research': 'SCIENTIFIC METHOD',
            'ethics': 'ETHICAL REASONING',
            'fallacies': 'LOGICAL REASONING',
            'persuasion': 'RHETORICAL AWARENESS',
            'literacy': 'MEDIA LITERACY',
            'bias': 'COGNITIVE AWARENESS',
            'data': 'STATISTICAL LITERACY',
            'verify': 'VERIFICATION METHODS'
        };

        function showActionFactoid(action) {
            if (typeof VeracityActionFactoids !== 'undefined') {
                const factoid = VeracityActionFactoids.sync.getRandomActionFactoid(action);
                if (factoid) {
                    document.getElementById('factoidCategory').textContent = actionLabels[action] || action.toUpperCase();
                    document.getElementById('factoidText').textContent = factoid.text;
                    document.getElementById('factoidDisplay').classList.add('visible');
                }
            }
        }

        // Add click handlers for sidebar-action buttons
        document.querySelectorAll('.sidebar-action[data-action]').forEach(btn => {
            btn.addEventListener('click', () => showActionFactoid(btn.dataset.action));
        });

        // ==================== MICRO-DISCOVERY (Numbers Column) ====================
        const microDisciplines = ['history', 'sciences', 'philosophy', 'logic', 'rhetoric', 'media', 'psychology', 'statistics', 'sources', 'export'];
        let tooltipEl = null;

        function initMicroDiscovery() {
            if (typeof VeracityMicroDiscovery === 'undefined') return;
            document.querySelectorAll('.sidebar-number').forEach((el, i) => {
                if (i < microDisciplines.length) {
                    const entry = VeracityMicroDiscovery.sync.getRandomEntry(microDisciplines[i]);
                    if (entry) {
                        el.textContent = entry.displayValue;
                        el.dataset.tooltip = entry.tooltip;
                        el.dataset.discipline = microDisciplines[i];
                        el.title = entry.tooltip; // Native tooltip as backup
                    }
                }
            });
        }
        initMicroDiscovery();

        // Custom tooltip for numbers on hover
        function showNumberTooltip(el, event) {
            if (!el.dataset.tooltip) return;
            
            // Remove any existing tooltip
            hideNumberTooltip();
            
            // Create tooltip element
            tooltipEl = document.createElement('div');
            tooltipEl.className = 'micro-tooltip';
            tooltipEl.textContent = el.dataset.tooltip;
            tooltipEl.style.cssText = `
                position: fixed;
                background: var(--bg-tertiary, #2d4a6f);
                color: var(--text-primary, #fff);
                padding: 8px 12px;
                border-radius: 6px;
                font-size: 12px;
                max-width: 280px;
                z-index: 10000;
                pointer-events: none;
                box-shadow: 0 4px 12px rgba(0,0,0,0.4);
                border: 1px solid var(--accent-amber, #d4a853);
                line-height: 1.4;
            `;
            document.body.appendChild(tooltipEl);
            
            // Position tooltip
            const rect = el.getBoundingClientRect();
            tooltipEl.style.left = (rect.right + 10) + 'px';
            tooltipEl.style.top = rect.top + 'px';
            
            // Adjust if off-screen
            const tooltipRect = tooltipEl.getBoundingClientRect();
            if (tooltipRect.right > window.innerWidth - 10) {
                tooltipEl.style.left = (rect.left - tooltipRect.width - 10) + 'px';
            }
            if (tooltipRect.bottom > window.innerHeight - 10) {
                tooltipEl.style.top = (window.innerHeight - tooltipRect.height - 10) + 'px';
            }
        }

        function hideNumberTooltip() {
            if (tooltipEl) {
                tooltipEl.remove();
                tooltipEl = null;
            }
        }

        // Add hover handlers for number tooltips
        document.querySelectorAll('.sidebar-number').forEach(el => {
            el.addEventListener('mouseenter', (e) => showNumberTooltip(el, e));
            el.addEventListener('mouseleave', hideNumberTooltip);
            
            // Make numbers clickable to refresh with new content
            el.style.cursor = 'pointer';
            el.addEventListener('click', () => {
                if (typeof VeracityMicroDiscovery !== 'undefined' && el.dataset.discipline) {
                    const entry = VeracityMicroDiscovery.sync.getRandomEntry(el.dataset.discipline);
                    if (entry) {
                        el.textContent = entry.displayValue;
                        el.dataset.tooltip = entry.tooltip;
                        el.title = entry.tooltip;
                        // Show the new tooltip briefly
                        showNumberTooltip(el);
                        setTimeout(hideNumberTooltip, 2000);
                    }
                }
            });
        });

        // UI State
        const trackInfo = {
            'A': { get name() { return getTranslation('trackAssess', getCurrentLanguage()); }, desc: 'Factual evaluation mode' },
            'B': { get name() { return getTranslation('trackConversation', getCurrentLanguage()); }, desc: 'Socratic exploration mode' },
            'C': { get name() { return getTranslation('trackNavigate', getCurrentLanguage()); }, desc: 'Practical guidance mode' },
            'AMBIGUOUS': { name: 'CLARIFY', desc: 'Additional context needed' }
        };

        const userInput = document.getElementById('userInput');
        const submitBtn = document.getElementById('submitBtn');
        const clearBtn = document.getElementById('clearBtn');
        const clockDisplay = document.getElementById('clockDisplay');
        const statusBar = document.getElementById('statusBar');
        const resultsSection = document.getElementById('resultsSection');
        const resultCard = document.getElementById('resultCard');
        const resultTrack = document.getElementById('resultTrack');
        const resultName = document.getElementById('resultName');
        const resultConfidence = document.getElementById('resultConfidence');
        const resultEmpathy = document.getElementById('resultEmpathy');
        const resultReasoning = document.getElementById('resultReasoning');
        const clarifySection = document.getElementById('clarifySection');
        const continueBtn = document.getElementById('continueBtn');
        const notQuiteBtn = document.getElementById('notQuiteBtn');
        const researchBtn = document.getElementById('researchBtn');

        const btnTrackA = document.getElementById('btnTrackA');
        const btnTrackB = document.getElementById('btnTrackB');
        const btnTrackC = document.getElementById('btnTrackC');
        const btnWorking = document.getElementById('btnWorking');

        let currentResult = null;
        let timerInterval = null;
        let elapsedTime = 0;
        let sessionState = typeof VeracityExport !== 'undefined' ? VeracityExport.createSessionState() : {};

        const trackLauncher = {
            urls: { 'A': 'assess.html', 'B': 'interview.html', 'C': 'navigate.html' },
            mode: 'same',
            passQuery: true
        };

        function launchTrack(track, query) {
            const url = trackLauncher.urls[track];
            if (!url) {
                alert(`Track ${track}: ${trackInfo[track].name}\n\n${trackInfo[track].desc}\n\n(Coming soon)`);
                return;
            }
            let launchUrl = url;
            if (trackLauncher.passQuery && query) {
                launchUrl = `${url}?q=${encodeURIComponent(query)}`;
            }
            if (track === 'A' && query) launchUrl += '&auto=true';
            window.location.href = launchUrl;
        }

        function resetTrackButtons() {
            btnTrackA.classList.remove('active');
            btnTrackB.classList.remove('active');
            btnTrackC.classList.remove('active');
            btnWorking.classList.remove('active');
        }

        function activateTrack(track) {
            resetTrackButtons();
            if (track === 'A') btnTrackA.classList.add('active');
            else if (track === 'B') btnTrackB.classList.add('active');
            else if (track === 'C') btnTrackC.classList.add('active');
        }

        function startTimer() {
            elapsedTime = 0;
            btnWorking.classList.add('active');
            clockDisplay.classList.add('processing');
            timerInterval = setInterval(() => {
                elapsedTime += 10;
                const secs = Math.floor(elapsedTime / 1000);
                const ms = Math.floor((elapsedTime % 1000) / 10);
                clockDisplay.textContent = `00:00:${String(secs).padStart(2,'0')}.${String(ms).padStart(2,'0')}`;
            }, 10);
        }

        function stopTimer() {
            clearInterval(timerInterval);
            btnWorking.classList.remove('active');
            clockDisplay.classList.remove('processing');
            updateClock();
        }

        submitBtn.addEventListener('click', async () => {
            const input = userInput.value.trim();
            if (!input) return;

            hideFactoid();
            resultsSection.classList.remove('visible');
            resetTrackButtons();
            submitBtn.disabled = true;
            startTimer();
            
            // ═══════════════════════════════════════════════════════════════
            // SEARCH-FIRST ARCHITECTURE: Preflight search before classification
            // "Bulletproof from arrogance" - never form opinion before searching
            // ═══════════════════════════════════════════════════════════════
            
            let preflightContext = null;
            statusBar.textContent = getTranslation('verVerifying', getCurrentLanguage());
            
            try {
                const preflightResponse = await Promise.race([
                    fetch('/api/preflight-search', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            claim: input,
                            language: localStorage.getItem('veritasLanguage') || 'en'
                        })
                    }),
                    // Timeout after 12 seconds
                    new Promise((_, reject) => 
                        setTimeout(() => reject(new Error('Preflight search timeout')), 12000)
                    )
                ]);
                
                if (preflightResponse.ok) {
                    const preflightData = await preflightResponse.json();
                    if (preflightData.success && preflightData.structured) {
                        preflightContext = preflightData.structured;
                        console.log('Preflight search completed:', preflightData.elapsedMs + 'ms');
                    }
                }
            } catch (preflightError) {
                console.warn('Preflight search unavailable:', preflightError.message);
                // Continue without preflight - tracks will search independently
            }
            
            // Store preflight context for use by tracks
            window.veritasPreflightContext = preflightContext;
            
            statusBar.textContent = getTranslation('verClassifying', getCurrentLanguage());

            await new Promise(r => setTimeout(r, 300 + Math.random() * 300));

            if (typeof VeracityClassifier !== 'undefined') {
                currentResult = VeracityClassifier.classifyIntent(input);
            } else {
                currentResult = { track: 'A', confidence: 85, reasoning: 'Default classification' };
            }
            stopTimer();

            const info = trackInfo[currentResult.track];
            const trackClass = currentResult.track === 'AMBIGUOUS' ? '' : `track-${currentResult.track.toLowerCase()}`;

            if (currentResult.track === 'AMBIGUOUS') {
                resultCard.style.display = 'none';
                await resetClarifyOptions(input);
                clarifySection.classList.add('visible');
                continueBtn.style.display = 'none';
            } else {
                resultCard.style.display = 'block';
                resultCard.className = `result-card ${trackClass}`;
                resultTrack.className = `result-track ${trackClass}`;
                resultTrack.textContent = currentResult.track;
                resultName.className = `result-name ${trackClass}`;
                resultName.textContent = info.name;
                resultConfidence.textContent = `${currentResult.confidence}% ${getTranslation('verConfidence', getCurrentLanguage())}`;
                resultEmpathy.textContent = currentResult.empathyMessage || '';
                resultReasoning.textContent = currentResult.reasoning;
                clarifySection.classList.remove('visible');
                continueBtn.style.display = 'inline-block';
                activateTrack(currentResult.track);
            }

            statusBar.textContent = `${getTranslation('verClassified', getCurrentLanguage())} ${currentResult.track}`;
            resultsSection.classList.add('visible');
            submitBtn.disabled = false;
        });

        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') submitBtn.click();
        });

        notQuiteBtn.addEventListener('click', async () => {
            document.getElementById('actionRow').style.display = 'none';
            await resetClarifyOptions(userInput.value.trim());
            clarifySection.classList.add('visible');
        });

        continueBtn.addEventListener('click', () => {
            if (currentResult && currentResult.track && currentResult.track !== 'AMBIGUOUS') {
                launchTrack(currentResult.track, userInput.value.trim());
            }
        });

        // Adaptive Clarification - Claude API powered button generation
        const VeracityAdaptive = {
            generateButtons: async function(input, language = null) {
                const lang = language || localStorage.getItem('veritasLanguage') || 'en';
                if (!input || !input.trim()) return this.getFallbackButtons(lang);
                
                // TEMPORAL QUERIES: Skip AI generation entirely - use fact-neutral buttons
                // The /api/claude endpoint is defunct and we can't trust training data
                // for deaths, current positions, recent events
                const temporalPatterns = [
                    /\b(dead|died|alive|killed|murdered|death|assassination|assassinated|passed away)\b/i,
                    /\b(current|currently|still|now)\s+(is|are|serves?|holds?)\b/i,
                    /\b(confirmed|appointed|sworn|resigned|fired|elected|won|lost)\b/i
                ];
                const isTemporalQuery = temporalPatterns.some(p => p.test(input));
                
                if (isTemporalQuery) {
                    console.log('Temporal query detected - using fact-neutral buttons');
                    return {
                        trackA: { label: 'Help me verify the current facts on this', track: 'A' },
                        trackB: { label: 'I want to explore different perspectives on this', track: 'B' },
                        trackC: { label: 'Help me navigate a conversation about this', track: 'C' }
                    };
                }
                
                try {
                    const buttonData = await this.callClaudeAPI(input, lang);
                    return this.formatButtonResponse(buttonData);
                } catch (error) {
                    console.error('VeracityAdaptive API Error:', error);
                    return this.getFallbackButtons(lang);
                }
            },

            callClaudeAPI: async function(userInput, lang) {
                const prompt = this.buildPrompt(userInput, lang);
                const response = await fetch("/api/claude", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        prompt: prompt,
                        model: "claude-sonnet-4-20250514",
                        max_tokens: 600,
                        temperature: 0.7,
                        messages: [{ role: "user", content: prompt }]
                    })
                });
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    if (errorData.fallback) throw new Error('API unavailable - using fallback');
                    throw new Error(`API returned ${response.status}`);
                }
                const data = await response.json();
                return this.parseClaudeResponse(data.content[0].text);
            },

            buildPrompt: function(userInput, lang) {
                const languageNames = {
                    en: 'English', es: 'Spanish', fr: 'French', de: 'German',
                    pt: 'Portuguese', ru: 'Russian', uk: 'Ukrainian', el: 'Greek',
                    zh: 'Chinese (Simplified)', ja: 'Japanese', ko: 'Korean',
                    ar: 'Arabic', he: 'Hebrew', it: 'Italian'
                };
                const targetLanguage = languageNames[lang] || 'English';
                const languageInstruction = lang !== 'en' 
                    ? `\n\nIMPORTANT: Generate all button text in ${targetLanguage}.`
                    : '';
                
                return `A user asked: "${userInput}"

Generate three button options that meet them where they are. Use their language, match their tone, acknowledge their feelings.

Track A (Assess): Fact-checking, evidence, verification  
Track B (Interview): Exploring beliefs, understanding perspectives, Socratic dialogue  
Track C (Navigate): Practical help with relationships, difficult conversations, life situations

CRITICAL RULES:
1. MATCH THEIR LANGUAGE - If they say "fucking moron", you can reference that directly
2. BE DIRECT - Don't sanitize or soften their words unless it helps clarity
3. MEET THEM WHERE THEY ARE - Frustrated? Acknowledge it. Curious? Reflect that.
4. KEEP IT REAL - Sound like a human friend, not a therapist or robot
5. Each button: 80-150 characters${languageInstruction}

Respond ONLY with valid JSON (no markdown, no code blocks):
{
  "trackA": "button text",
  "trackB": "button text",
  "trackC": "button text"
}`;
            },

            parseClaudeResponse: function(rawText) {
                const cleaned = rawText.replace(/```json\n?/g, '').replace(/```\n?/g, '').trim();
                const parsed = JSON.parse(cleaned);
                if (!parsed.trackA || !parsed.trackB || !parsed.trackC) {
                    throw new Error('Missing required track buttons');
                }
                return parsed;
            },

            formatButtonResponse: function(buttonData) {
                return {
                    trackA: { label: buttonData.trackA, track: 'A' },
                    trackB: { label: buttonData.trackB, track: 'B' },
                    trackC: { label: buttonData.trackC, track: 'C' }
                };
            },

            getFallbackButtons: function(lang) {
                return {
                    trackA: { label: 'I want to verify facts', track: 'A' },
                    trackB: { label: 'I want to explore my thinking', track: 'B' },
                    trackC: { label: 'I need practical guidance', track: 'C' }
                };
            }
        };

        async function resetClarifyOptions(inputText = '') {
            const clarifyQuestion = document.getElementById('clarifyQuestion');
            const clarifyOptions = document.getElementById('clarifyOptions');
            
            clarifyQuestion.innerHTML = getTranslation('verClarifyAnalyzing', getCurrentLanguage());
            clarifyOptions.innerHTML = '<div style="text-align:center;padding:20px;color:var(--text-muted);"><div class="loading-pulse">' + getTranslation('verClarifyGenerating', getCurrentLanguage()) + '</div></div>';
            
            const buttons = await VeracityAdaptive.generateButtons(inputText);
            
            clarifyQuestion.innerHTML = getTranslation('verClarifyQuestion', getCurrentLanguage());
            clarifyOptions.innerHTML = `
                <button class="clarify-btn" data-track="A">${buttons.trackA.label}</button>
                <button class="clarify-btn" data-track="B">${buttons.trackB.label}</button>
                <button class="clarify-btn" data-track="C">${buttons.trackC.label}</button>
            `;
            attachClarifyListeners();
        }

        function attachClarifyListeners() {
            document.querySelectorAll('.clarify-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    launchTrack(this.dataset.track, userInput.value.trim());
                });
            });
        }

        attachClarifyListeners();

        document.querySelectorAll('.example-chip').forEach(chip => {
            chip.addEventListener('click', () => {
                userInput.value = chip.dataset.input;
                userInput.focus();
                submitBtn.click();
            });
        });

        clearBtn.addEventListener('click', () => {
            userInput.value = '';
            userInput.focus();
            resultsSection.classList.remove('visible');
            clarifySection.classList.remove('visible');
            resetTrackButtons();
            statusBar.textContent = getTranslation('statusAwaiting', getCurrentLanguage());
            currentResult = null;
            hideFactoid();
        });

        // Test panel
        const testToggle = document.getElementById('testToggle');
        const testPanel = document.getElementById('testPanel');
        const passwordModal = document.getElementById('passwordModal');
        const passwordInput = document.getElementById('testPassword');
        const passwordSubmit = document.getElementById('passwordSubmit');
        const passwordCancel = document.getElementById('passwordCancel');
        const passwordError = document.getElementById('passwordError');
        let testUnlocked = false;

        testToggle.addEventListener('click', () => {
            if (testPanel.classList.contains('visible')) {
                testPanel.classList.remove('visible');
                testToggle.textContent = 'TEST HARNESS';
            } else if (testUnlocked) {
                testPanel.classList.add('visible');
                testToggle.textContent = 'HIDE TESTS';
            } else {
                passwordModal.style.display = 'flex';
                passwordInput.value = '';
                passwordError.style.display = 'none';
                passwordInput.focus();
            }
        });

        passwordSubmit.addEventListener('click', () => {
            if (passwordInput.value === '122590') {
                testUnlocked = true;
                passwordModal.style.display = 'none';
                testPanel.classList.add('visible');
                testToggle.textContent = 'HIDE TESTS';
            } else {
                passwordError.style.display = 'block';
                passwordInput.value = '';
                passwordInput.focus();
            }
        });

        passwordInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') passwordSubmit.click();
        });

        passwordCancel.addEventListener('click', () => {
            passwordModal.style.display = 'none';
        });

        document.querySelectorAll('.test-item').forEach(item => {
            item.addEventListener('click', () => {
                userInput.value = item.dataset.input;
                testPanel.classList.remove('visible');
                testToggle.textContent = 'TEST HARNESS';
                submitBtn.click();
            });
        });

        // Language Test panel
        const langTestToggle = document.getElementById('langTestToggle');
        const langTestPanel = document.getElementById('langTestPanel');
        const langPasswordModal = document.getElementById('langPasswordModal');
        const langPasswordInput = document.getElementById('langTestPassword');
        const langPasswordSubmit = document.getElementById('langPasswordSubmit');
        const langPasswordCancel = document.getElementById('langPasswordCancel');
        const langPasswordError = document.getElementById('langPasswordError');
        let langTestUnlocked = false;

        langTestToggle.addEventListener('click', () => {
            if (langTestPanel.classList.contains('visible')) {
                langTestPanel.classList.remove('visible');
                langTestToggle.textContent = '🌐 LANG TEST';
            } else if (langTestUnlocked) {
                langTestPanel.classList.add('visible');
                langTestToggle.textContent = '🌐 HIDE LANG';
            } else {
                langPasswordModal.style.display = 'flex';
                langPasswordInput.value = '';
                langPasswordError.style.display = 'none';
                langPasswordInput.focus();
            }
        });

        langPasswordSubmit.addEventListener('click', () => {
            if (langPasswordInput.value === '122590') {
                langTestUnlocked = true;
                langPasswordModal.style.display = 'none';
                langTestPanel.classList.add('visible');
                langTestToggle.textContent = '🌐 HIDE LANG';
            } else {
                langPasswordError.style.display = 'block';
                langPasswordInput.value = '';
                langPasswordInput.focus();
            }
        });

        langPasswordInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') langPasswordSubmit.click();
        });

        langPasswordCancel.addEventListener('click', () => {
            langPasswordModal.style.display = 'none';
        });

        document.querySelectorAll('.lang-test-item').forEach(item => {
            item.addEventListener('click', () => {
                const lang = item.dataset.lang;
                const claim = item.dataset.claim;
                
                // Set the language in localStorage (VINCULUM will pick this up)
                localStorage.setItem('veritasLanguage', lang);
                
                // Update the language selector if visible
                const langSelector = document.getElementById('languageSelect');
                if (langSelector) {
                    langSelector.value = lang;
                }
                
                // Apply translations immediately
                if (typeof applyTranslations === 'function') {
                    applyTranslations(lang);
                }
                
                // Set the claim in the input
                userInput.value = claim;
                
                // Hide the panel
                langTestPanel.classList.remove('visible');
                langTestToggle.textContent = '🌐 LANG TEST';
                
                // Show a brief indicator of which language is being tested
                const statusBar = document.getElementById('statusBar');
                const originalText = statusBar.textContent;
                statusBar.textContent = `TESTING: ${lang.toUpperCase()} → ${claim.substring(0, 30)}...`;
                statusBar.style.color = 'var(--accent-purple)';
                
                setTimeout(() => {
                    statusBar.style.color = '';
                    // Submit the claim
                    submitBtn.click();
                }, 500);
            });
        });

        // Research button
        researchBtn.addEventListener('click', () => {
            window.location.href = 'assess.html';
        });

        // Weather
        async function fetchWeather(lat, lon) {
            try {
                const response = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m&daily=temperature_2m_max,temperature_2m_min&temperature_unit=fahrenheit&timezone=auto`);
                const data = await response.json();
                const geoResponse = await fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${lat}&longitude=${lon}&localityLanguage=en`);
                const geoData = await geoResponse.json();
                const city = geoData.locality || geoData.city || 'Unknown';
                const state = geoData.principalSubdivisionCode?.replace('US-', '') || '';
                const location = state ? `${city}, ${state}` : city;
                const currentTemp = Math.round(data.current.temperature_2m);
                const highTemp = Math.round(data.daily.temperature_2m_max[0]);
                const lowTemp = Math.round(data.daily.temperature_2m_min[0]);
                document.getElementById('weatherDisplay').textContent = `${location.toUpperCase()} — ${currentTemp}°F — HI: ${highTemp}° LO: ${lowTemp}°`;
            } catch (e) {
                document.getElementById('weatherDisplay').textContent = 'WEATHER UNAVAILABLE';
            }
        }

        if ('geolocation' in navigator) {
            navigator.geolocation.getCurrentPosition(
                (pos) => fetchWeather(pos.coords.latitude, pos.coords.longitude),
                () => document.getElementById('weatherDisplay').textContent = 'LOCATION UNAVAILABLE'
            );
        }

        // Language handled by modules/veritas-translations.js

        // ==================== WARP CORE PULSE & TOS BRIDGE AMBIENT AUDIO ====================
        // Classic Star Trek bridge background sounds with warp core pulse animation
        let bridgeAudio = null;
        let audioPlaying = false;

        function initBridgeAudio() {
            // TOS Bridge Ambient Sound - loops continuously
            bridgeAudio = new Audio('/sounds/eprd-bridge.wav');
            bridgeAudio.loop = true;
            bridgeAudio.volume = 0.25; // Subtle but present background
            
            // Restore previous state
            const wasPlaying = localStorage.getItem('bridgeAudioPlaying') === 'true';
            if (wasPlaying) {
                document.getElementById('audioToggle').title = 'Click to resume Warp Core';
            }
        }

        function toggleBridgeAudio() {
            const toggle = document.getElementById('audioToggle');
            const pulseContainer = document.getElementById('warpPulseContainer');
            const pulseTopbar = document.getElementById('warpPulseTopbar');
            
            if (!bridgeAudio) {
                initBridgeAudio();
            }
            
            if (audioPlaying) {
                // Stop audio and pulse
                bridgeAudio.pause();
                audioPlaying = false;
                toggle.classList.remove('playing');
                toggle.title = 'Engage Warp Core';
                
                // Deactivate pulse animation
                if (pulseContainer) pulseContainer.classList.remove('active');
                if (pulseTopbar) pulseTopbar.classList.remove('active');
                
                localStorage.setItem('bridgeAudioPlaying', 'false');
            } else {
                // Start audio and pulse
                bridgeAudio.play().then(() => {
                    audioPlaying = true;
                    toggle.classList.add('playing');
                    toggle.title = 'Disengage Warp Core';
                    
                    // Activate pulse animation
                    if (pulseContainer) pulseContainer.classList.add('active');
                    if (pulseTopbar) pulseTopbar.classList.add('active');
                    
                    localStorage.setItem('bridgeAudioPlaying', 'true');
                }).catch(err => {
                    console.log('Audio playback requires user interaction first');
                    toggle.title = 'Click again to engage Warp Core';
                    
                    // Still activate the visual pulse even if audio fails
                    if (pulseContainer) pulseContainer.classList.add('active');
                    if (pulseTopbar) pulseTopbar.classList.add('active');
                    audioPlaying = true;
                    toggle.classList.add('playing');
                });
            }
        }

        // Initialize audio system
        initBridgeAudio();

        // ==================== SALIENCE GLOW TEST ====================
        // Double-click any discipline button to cycle through glow states
        // This is for testing/demo - in production, the classifier sets these
        const salienceStates = ['', 'salience-low', 'salience-medium', 'salience-high'];
        
        document.querySelectorAll('.sidebar-label').forEach(btn => {
            btn.addEventListener('dblclick', (e) => {
                e.preventDefault();
                // Find current state
                let currentIndex = 0;
                salienceStates.forEach((state, i) => {
                    if (state && btn.classList.contains(state)) currentIndex = i;
                });
                // Remove current state
                if (salienceStates[currentIndex]) {
                    btn.classList.remove(salienceStates[currentIndex]);
                }
                // Add next state
                const nextIndex = (currentIndex + 1) % salienceStates.length;
                if (salienceStates[nextIndex]) {
                    btn.classList.add(salienceStates[nextIndex]);
                }
                console.log(`${btn.textContent}: ${salienceStates[nextIndex] || 'none'}`);
            });
        });
        
        // Same for sidebar-action buttons (right column)
        document.querySelectorAll('.sidebar-action').forEach(btn => {
            btn.addEventListener('dblclick', (e) => {
                e.preventDefault();
                let currentIndex = 0;
                salienceStates.forEach((state, i) => {
                    if (state && btn.classList.contains(state)) currentIndex = i;
                });
                if (salienceStates[currentIndex]) {
                    btn.classList.remove(salienceStates[currentIndex]);
                }
                const nextIndex = (currentIndex + 1) % salienceStates.length;
                if (salienceStates[nextIndex]) {
                    btn.classList.add(salienceStates[nextIndex]);
                }
                console.log(`${btn.textContent}: ${salienceStates[nextIndex] || 'none'}`);
            });
        });
        
        console.log('💡 TIP: Double-click any sidebar button to test salience glow states');

        // ==================== NUMBER SCALING FOR SIDEBAR ====================
        // Auto-scale font size for numbers that are too long
        function scaleNumberDisplays() {
            document.querySelectorAll('.sidebar-number').forEach(numEl => {
                const text = numEl.textContent.trim();
                // If number is 4+ digits, make font smaller
                if (text.length >= 4) {
                    numEl.classList.add('compact');
                } else {
                    numEl.classList.remove('compact');
                }
            });
        }
        
        // Run on page load
        scaleNumberDisplays();
        
        // Re-run whenever numbers change (e.g., export count updates)
        const numberObserver = new MutationObserver(scaleNumberDisplays);
        document.querySelectorAll('.sidebar-number').forEach(numEl => {
            numberObserver.observe(numEl, { childList: true, characterData: true, subtree: true });
        });
        
        console.log('🔢 Number display scaling initialized');


        // ==================== MOBILE HAMBURGER MENU ====================
        const hamburgerBtn = document.getElementById('hamburgerBtn');
        const mobileSidebar = document.getElementById('mobileSidebar');
        const mobileSidebarOverlay = document.getElementById('mobileSidebarOverlay');

        function openMobileSidebar() {
            hamburgerBtn.classList.add('active');
            mobileSidebarOverlay.style.display = 'block';
            mobileSidebar.style.display = 'block';
            // Trigger reflow for animation
            requestAnimationFrame(() => {
                mobileSidebarOverlay.classList.add('visible');
                mobileSidebar.classList.add('visible');
            });
            document.body.style.overflow = 'hidden';
        }

        function closeMobileSidebar() {
            hamburgerBtn.classList.remove('active');
            mobileSidebarOverlay.classList.remove('visible');
            mobileSidebar.classList.remove('visible');
            document.body.style.overflow = '';
            // Wait for animation to complete before hiding
            setTimeout(() => {
                mobileSidebarOverlay.style.display = 'none';
                mobileSidebar.style.display = 'none';
            }, 350);
        }

        hamburgerBtn.addEventListener('click', () => {
            if (mobileSidebar.classList.contains('visible')) {
                closeMobileSidebar();
            } else {
                openMobileSidebar();
            }
        });

        mobileSidebarOverlay.addEventListener('click', closeMobileSidebar);

        // Close sidebar on escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && mobileSidebar.classList.contains('visible')) {
                closeMobileSidebar();
            }
        });

        // Mobile sidebar item clicks - trigger factoids
        document.querySelectorAll('.mobile-sidebar-item[data-factoid]').forEach(item => {
            item.addEventListener('click', () => {
                const factoidKey = item.dataset.factoid;
                // Trigger the same factoid display as desktop
                if (typeof showFactoid === 'function') {
                    showFactoid(factoidKey);
                }
                closeMobileSidebar();
            });
        });

        // Sync export count between desktop and mobile
        const mobileExportCount = document.getElementById('mobileExportCount');
        const desktopExportCount = document.getElementById('exportCount');
        if (mobileExportCount && desktopExportCount) {
            // Create a MutationObserver to sync changes
            const observer = new MutationObserver(() => {
                mobileExportCount.textContent = desktopExportCount.textContent;
            });
            observer.observe(desktopExportCount, { childList: true, characterData: true, subtree: true });
        }

        console.log('📱 Mobile sidebar initialized');

        // ==================== MOBILE CONTROLS (Audio + Test Buttons) ====================
        const mobileAudioToggle = document.getElementById('mobileAudioToggle');
        const mobileTestToggle = document.getElementById('mobileTestToggle');
        const mobileLangTestToggle = document.getElementById('mobileLangTestToggle');
        const desktopAudioToggle = document.getElementById('audioToggle');
        
        // Mobile Audio Toggle
        if (mobileAudioToggle) {
            mobileAudioToggle.addEventListener('click', () => {
                if (typeof toggleBridgeAudio === 'function') {
                    toggleBridgeAudio();
                }
                // Sync visual state after a brief delay for the toggle to complete
                setTimeout(() => {
                    if (desktopAudioToggle && desktopAudioToggle.classList.contains('playing')) {
                        mobileAudioToggle.classList.add('playing');
                        mobileAudioToggle.title = 'Disengage Warp Core';
                    } else {
                        mobileAudioToggle.classList.remove('playing');
                        mobileAudioToggle.title = 'Engage Warp Core';
                    }
                }, 100);
            });
            
            // Keep mobile toggle in sync with desktop state changes
            if (desktopAudioToggle) {
                const audioObserver = new MutationObserver(() => {
                    if (desktopAudioToggle.classList.contains('playing')) {
                        mobileAudioToggle.classList.add('playing');
                        mobileAudioToggle.title = 'Disengage Warp Core';
                    } else {
                        mobileAudioToggle.classList.remove('playing');
                        mobileAudioToggle.title = 'Engage Warp Core';
                    }
                });
                audioObserver.observe(desktopAudioToggle, { attributes: true, attributeFilter: ['class'] });
            }
        }
        
        // Mobile Test Harness Toggle
        if (mobileTestToggle) {
            mobileTestToggle.addEventListener('click', () => {
                // Trigger the desktop test toggle click
                testToggle.click();
            });
        }
        
        // Mobile Lang Test Toggle
        if (mobileLangTestToggle) {
            mobileLangTestToggle.addEventListener('click', () => {
                // Trigger the desktop lang test toggle click
                langTestToggle.click();
            });
        }
        
        console.log('🎛️ Mobile controls initialized');
    </script>
</body>
</html>
